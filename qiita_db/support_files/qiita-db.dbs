<?xml version="1.0" encoding="UTF-8" ?>
<project name="qiita" id="Project669804" database="PostgreSQL" >
	<comment>Qiita-DB layout</comment>
	<schema name="qiita" schemaname="qiita" defo="y" >
		<table name="analysis" >
			<comment>hHolds analysis information</comment>
			<column name="analysis_id" type="bigserial" jt="-5" mandatory="y" >
				<comment><![CDATA[Unique identifier for analysis]]></comment>
			</column>
			<column name="email" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[Email for user who owns the analysis]]></comment>
			</column>
			<column name="name" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[Name of the analysis]]></comment>
			</column>
			<column name="description" type="varchar" jt="12" mandatory="y" />
			<column name="analysis_status_id" type="bigint" jt="-5" mandatory="y" />
			<column name="pmid" type="varchar" jt="12" >
				<comment><![CDATA[PMID of paper from the analysis]]></comment>
			</column>
			<index name="pk_analysis" unique="PRIMARY_KEY" >
				<column name="analysis_id" />
			</index>
			<index name="idx_analysis_email" unique="NORMAL" >
				<column name="email" />
			</index>
			<index name="idx_analysis_status_id" unique="NORMAL" >
				<column name="analysis_status_id" />
			</index>
			<fk name="fk_analysis_user" to_schema="qiita" to_table="qiita_user" >
				<fk_column name="email" pk="email" />
			</fk>
			<fk name="fk_analysis_analysis_status" to_schema="qiita" to_table="analysis_status" >
				<fk_column name="analysis_status_id" pk="analysis_status_id" />
			</fk>
		</table>
		<table name="analysis_chain" >
			<comment>Keeps track of the chain of analysis edits. Tracks what previous analysis a given analysis came from.
If a given analysis is not in child_id, it is the root of the chain. </comment>
			<column name="parent_id" type="bigint" jt="-5" mandatory="y" />
			<column name="child_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_analysis_chain" unique="NORMAL" >
				<column name="parent_id" />
			</index>
			<index name="idx_analysis_chain_0" unique="NORMAL" >
				<column name="child_id" />
			</index>
			<index name="idx_analysis_chain_1" unique="PRIMARY_KEY" >
				<column name="parent_id" />
				<column name="child_id" />
			</index>
			<fk name="fk_analysis_chain" to_schema="qiita" to_table="analysis" >
				<fk_column name="parent_id" pk="analysis_id" />
			</fk>
			<fk name="fk_analysis_chain_0" to_schema="qiita" to_table="analysis" >
				<fk_column name="child_id" pk="analysis_id" />
			</fk>
		</table>
		<table name="analysis_filepath" >
			<comment>Stores link between analysis and the data file used for the analysis.</comment>
			<column name="analysis_id" type="bigint" jt="-5" mandatory="y" />
			<column name="filepath_id" type="bigint" jt="-5" mandatory="y" />
			<column name="data_type_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_analysis_filepath" unique="NORMAL" >
				<column name="analysis_id" />
			</index>
			<index name="idx_analysis_filepath_0" unique="NORMAL" >
				<column name="filepath_id" />
			</index>
			<index name="idx_analysis_filepath_1" unique="PRIMARY_KEY" >
				<column name="analysis_id" />
				<column name="filepath_id" />
			</index>
			<index name="idx_analysis_filepath_3" unique="NORMAL" >
				<column name="data_type_id" />
			</index>
			<fk name="fk_analysis_filepath" to_schema="qiita" to_table="analysis" >
				<fk_column name="analysis_id" pk="analysis_id" />
			</fk>
			<fk name="fk_analysis_filepath_0" to_schema="qiita" to_table="filepath" >
				<fk_column name="filepath_id" pk="filepath_id" />
			</fk>
			<fk name="fk_analysis_filepath_2" to_schema="qiita" to_table="data_type" >
				<fk_column name="data_type_id" pk="data_type_id" />
			</fk>
		</table>
		<table name="analysis_job" >
			<comment>Holds information for a one-to-many relation of analysis to the jobs in it</comment>
			<column name="analysis_id" type="bigint" jt="-5" mandatory="y" >
				<comment><![CDATA[Id of the analysis]]></comment>
			</column>
			<column name="job_id" type="bigint" jt="-5" mandatory="y" >
				<comment><![CDATA[Id for a job that is part of the analysis]]></comment>
			</column>
			<index name="idx_analysis_jobs" unique="PRIMARY_KEY" >
				<column name="analysis_id" />
				<column name="job_id" />
			</index>
			<index name="idx_analysis_job" unique="NORMAL" >
				<column name="analysis_id" />
			</index>
			<index name="idx_analysis_job_0" unique="NORMAL" >
				<column name="job_id" />
			</index>
			<fk name="fk_analysis_job_analysis" to_schema="qiita" to_table="analysis" delete_action="cascade" update_action="cascade" >
				<fk_column name="analysis_id" pk="analysis_id" />
			</fk>
			<fk name="fk_analysis_job_job" to_schema="qiita" to_table="job" >
				<fk_column name="job_id" pk="job_id" />
			</fk>
		</table>
		<table name="analysis_sample" >
			<column name="analysis_id" type="bigint" jt="-5" mandatory="y" />
			<column name="processed_data_id" type="bigint" jt="-5" mandatory="y" />
			<column name="sample_id" type="varchar" jt="12" mandatory="y" />
			<column name="study_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_analysis_sample" unique="NORMAL" >
				<column name="analysis_id" />
			</index>
			<index name="idx_analysis_sample_0" unique="NORMAL" >
				<column name="processed_data_id" />
			</index>
			<index name="idx_analysis_sample_1" unique="NORMAL" >
				<column name="sample_id" />
			</index>
			<index name="idx_analysis_sample_2" unique="NORMAL" >
				<column name="study_id" />
			</index>
			<fk name="fk_analysis_sample_analysis" to_schema="qiita" to_table="analysis" >
				<fk_column name="analysis_id" pk="analysis_id" />
			</fk>
			<fk name="fk_analysis_sample" to_schema="qiita" to_table="processed_data" >
				<fk_column name="processed_data_id" pk="processed_data_id" />
			</fk>
			<fk name="fk_analysis_sample_sample" to_schema="qiita" to_table="required_sample_info" >
				<fk_column name="sample_id" pk="sample_id" />
			</fk>
			<fk name="fk_analysis_sample_study" to_schema="qiita" to_table="study" >
				<fk_column name="study_id" pk="study_id" />
			</fk>
		</table>
		<table name="analysis_status" >
			<column name="analysis_status_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="status" type="varchar" jt="12" mandatory="y" />
			<index name="pk_analysis_status" unique="PRIMARY_KEY" >
				<column name="analysis_status_id" />
			</index>
		</table>
		<table name="analysis_users" >
			<comment>Links analyses to the users they are shared with</comment>
			<column name="analysis_id" type="bigint" jt="-5" mandatory="y" />
			<column name="email" type="varchar" jt="12" mandatory="y" />
			<index name="idx_analysis_users" unique="PRIMARY_KEY" >
				<column name="analysis_id" />
				<column name="email" />
			</index>
			<index name="idx_analysis_users_analysis" unique="NORMAL" >
				<column name="analysis_id" />
			</index>
			<index name="idx_analysis_users_email" unique="NORMAL" >
				<column name="email" />
			</index>
			<fk name="fk_analysis_users_analysis" to_schema="qiita" to_table="analysis" delete_action="cascade" update_action="cascade" >
				<fk_column name="analysis_id" pk="analysis_id" />
			</fk>
			<fk name="fk_analysis_users_user" to_schema="qiita" to_table="qiita_user" delete_action="cascade" update_action="cascade" >
				<fk_column name="email" pk="email" />
			</fk>
		</table>
		<table name="analysis_workflow" >
			<comment>Stores what step in_production analyses are on.</comment>
			<column name="analysis_id" type="bigint" jt="-5" mandatory="y" />
			<column name="step" type="integer" jt="4" mandatory="y" />
			<index name="pk_analysis_workflow" unique="PRIMARY_KEY" >
				<column name="analysis_id" />
			</index>
			<fk name="fk_analysis_workflow" to_schema="qiita" to_table="analysis" >
				<fk_column name="analysis_id" pk="analysis_id" />
			</fk>
		</table>
		<table name="annotation" >
			<column name="annotation_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="term_id" type="bigint" jt="-5" mandatory="y" />
			<column name="annotation_name" type="varchar" jt="12" mandatory="y" />
			<column name="annotation_num_value" type="bigint" jt="-5" />
			<column name="annotation_str_value" type="varchar" jt="12" />
			<index name="pk_annotation" unique="PRIMARY_KEY" >
				<column name="annotation_id" />
			</index>
			<index name="idx_annotation" unique="NORMAL" >
				<column name="term_id" />
			</index>
			<fk name="fk_annotation_term" to_schema="qiita" to_table="term" >
				<fk_column name="term_id" pk="term_id" />
			</fk>
		</table>
		<table name="checksum_algorithm" >
			<column name="checksum_algorithm_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="name" type="varchar" jt="12" mandatory="y" />
			<index name="pk_checksum_algorithm" unique="PRIMARY_KEY" >
				<column name="checksum_algorithm_id" />
			</index>
		</table>
		<table name="column_controlled_vocabularies" >
			<comment>Table relates a column with a controlled vocabulary.</comment>
			<column name="controlled_vocab_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="column_name" type="varchar" jt="12" mandatory="y" />
			<index name="idx_column_controlled_vocabularies" unique="PRIMARY_KEY" >
				<column name="controlled_vocab_id" />
				<column name="column_name" />
			</index>
			<index name="idx_column_controlled_vocabularies_0" unique="NORMAL" >
				<column name="column_name" />
			</index>
			<index name="idx_column_controlled_vocabularies_1" unique="NORMAL" >
				<column name="controlled_vocab_id" />
			</index>
			<fk name="fk_column_controlled_vocabularies" to_schema="qiita" to_table="mixs_field_description" >
				<fk_column name="column_name" pk="column_name" />
			</fk>
			<fk name="fk_column_controlled_vocab2" to_schema="qiita" to_table="controlled_vocabularies" >
				<fk_column name="controlled_vocab_id" pk="controlled_vocab_id" />
			</fk>
		</table>
		<table name="column_ontology" >
			<comment>This table relates a column with an ontology.</comment>
			<column name="column_name" type="varchar" jt="12" mandatory="y" />
			<column name="ontology_short_name" type="varchar" jt="12" mandatory="y" />
			<column name="bioportal_id" type="integer" jt="4" mandatory="y" />
			<column name="ontology_branch_id" type="integer" jt="4" mandatory="y" />
			<index name="idx_column_ontology" unique="PRIMARY_KEY" >
				<column name="column_name" />
				<column name="ontology_short_name" />
			</index>
			<index name="idx_column_ontology_0" unique="NORMAL" >
				<column name="column_name" />
			</index>
			<fk name="fk_column_ontology" to_schema="qiita" to_table="mixs_field_description" >
				<fk_column name="column_name" pk="column_name" />
			</fk>
		</table>
		<table name="command" >
			<comment>Available commands for jobs</comment>
			<column name="command_id" type="bigserial" jt="-5" mandatory="y" >
				<comment><![CDATA[Unique identifier for function]]></comment>
			</column>
			<column name="name" type="varchar" jt="12" mandatory="y" />
			<column name="command" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[What command to call to run this function]]></comment>
			</column>
			<column name="input" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[JSON of input options for the command]]></comment>
			</column>
			<column name="required" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[JSON of required options for the command]]></comment>
			</column>
			<column name="optional" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[JSON of optional options for command]]></comment>
			</column>
			<column name="output" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[JSON of output options for the command]]></comment>
			</column>
			<index name="pk_command" unique="PRIMARY_KEY" >
				<column name="command_id" />
			</index>
		</table>
		<table name="command_data_type" >
			<column name="command_id" type="bigint" jt="-5" mandatory="y" />
			<column name="data_type_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_command_data_type" unique="PRIMARY_KEY" >
				<column name="command_id" />
				<column name="data_type_id" />
			</index>
			<index name="idx_command_data_type_0" unique="NORMAL" >
				<column name="command_id" />
			</index>
			<index name="idx_command_data_type_1" unique="NORMAL" >
				<column name="data_type_id" />
			</index>
			<fk name="fk_command_data_type" to_schema="qiita" to_table="command" >
				<fk_column name="command_id" pk="command_id" />
			</fk>
			<fk name="fk_command_data_type_0" to_schema="qiita" to_table="data_type" >
				<fk_column name="data_type_id" pk="data_type_id" />
			</fk>
		</table>
		<table name="common_prep_info" >
			<column name="raw_data_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="sample_id" type="varchar" jt="12" mandatory="y" />
			<column name="center_name" type="varchar" jt="12" />
			<column name="center_project_name" type="varchar" jt="12" />
			<column name="ebi_submission_accession" type="varchar" jt="12" />
			<column name="ebi_study_accession" type="varchar" jt="12" />
			<column name="emp_status_id" type="bigint" jt="-5" mandatory="y" />
			<column name="data_type_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_required_prep_info" unique="NORMAL" >
				<column name="raw_data_id" />
			</index>
			<index name="idx_required_prep_info_0" unique="NORMAL" >
				<column name="emp_status_id" />
			</index>
			<index name="idx_required_prep_info_1" unique="PRIMARY_KEY" >
				<column name="raw_data_id" />
				<column name="sample_id" />
			</index>
			<index name="idx_required_prep_info_2" unique="NORMAL" >
				<column name="sample_id" />
			</index>
			<index name="idx_required_prep_info_3" unique="NORMAL" >
				<column name="data_type_id" />
			</index>
			<fk name="fk_required_prep_info_raw_data" to_schema="qiita" to_table="raw_data" >
				<fk_column name="raw_data_id" pk="raw_data_id" />
			</fk>
			<fk name="fk_required_prep_info_emp_status" to_schema="qiita" to_table="emp_status" >
				<fk_column name="emp_status_id" pk="emp_status_id" />
			</fk>
			<fk name="fk_required_prep_info" to_schema="qiita" to_table="required_sample_info" >
				<fk_column name="sample_id" pk="sample_id" />
			</fk>
			<fk name="fk_required_prep_info_0" to_schema="qiita" to_table="data_type" >
				<fk_column name="data_type_id" pk="data_type_id" />
			</fk>
		</table>
		<table name="controlled_vocab_values" >
			<column name="vocab_value_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="controlled_vocab_id" type="bigint" jt="-5" mandatory="y" />
			<column name="term" type="varchar" jt="12" mandatory="y" />
			<column name="order_by" type="varchar" jt="12" mandatory="y" />
			<column name="default_item" type="varchar" jt="12" />
			<index name="pk_controlled_vocab_values" unique="PRIMARY_KEY" >
				<column name="vocab_value_id" />
			</index>
			<index name="idx_controlled_vocab_values" unique="NORMAL" >
				<column name="controlled_vocab_id" />
			</index>
			<fk name="fk_controlled_vocab_values" to_schema="qiita" to_table="controlled_vocabularies" delete_action="cascade" update_action="cascade" >
				<fk_column name="controlled_vocab_id" pk="controlled_vocab_id" />
			</fk>
		</table>
		<table name="controlled_vocabularies" >
			<column name="controlled_vocab_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="vocab_name" type="varchar" jt="12" mandatory="y" />
			<index name="pk_controlled_vocabularies" unique="PRIMARY_KEY" >
				<column name="controlled_vocab_id" />
			</index>
		</table>
		<table name="data_type" >
			<column name="data_type_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="data_type" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[Data type (16S, metabolome, etc) the job will use]]></comment>
			</column>
			<index name="pk_data_type" unique="PRIMARY_KEY" >
				<column name="data_type_id" />
			</index>
		</table>
		<table name="dbxref" >
			<column name="dbxref_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="term_id" type="bigint" jt="-5" mandatory="y" />
			<column name="dbname" type="varchar" jt="12" mandatory="y" />
			<column name="accession" type="varchar" jt="12" mandatory="y" />
			<column name="description" type="varchar" jt="12" mandatory="y" />
			<column name="xref_type" type="varchar" jt="12" mandatory="y" />
			<index name="pk_dbxref" unique="PRIMARY_KEY" >
				<column name="dbxref_id" />
			</index>
			<index name="idx_dbxref" unique="NORMAL" >
				<column name="term_id" />
			</index>
			<fk name="fk_dbxref_term" to_schema="qiita" to_table="term" >
				<fk_column name="term_id" pk="term_id" />
			</fk>
		</table>
		<table name="emp_status" >
			<comment>All possible statuses for projects relating to EMP. Whether they are part of, processed in accordance to, or not part of EMP.</comment>
			<column name="emp_status_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="emp_status" type="varchar" jt="12" mandatory="y" />
			<index name="pk_emp_status" unique="PRIMARY_KEY" >
				<column name="emp_status_id" />
			</index>
		</table>
		<table name="filepath" >
			<column name="filepath_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="filepath" type="varchar" jt="12" mandatory="y" />
			<column name="filepath_type_id" type="bigint" jt="-5" mandatory="y" />
			<column name="checksum" type="varchar" jt="12" mandatory="y" />
			<column name="checksum_algorithm_id" type="bigint" jt="-5" mandatory="y" />
			<index name="pk_filepath" unique="PRIMARY_KEY" >
				<column name="filepath_id" />
			</index>
			<index name="idx_filepath" unique="NORMAL" >
				<column name="filepath_type_id" />
			</index>
			<fk name="fk_filepath" to_schema="qiita" to_table="filepath_type" >
				<fk_column name="filepath_type_id" pk="filepath_type_id" />
			</fk>
			<fk name="fk_filepath_0" to_schema="qiita" to_table="checksum_algorithm" >
				<fk_column name="checksum_algorithm_id" pk="checksum_algorithm_id" />
			</fk>
		</table>
		<table name="filepath_type" >
			<column name="filepath_type_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="filepath_type" type="varchar" jt="12" />
			<index name="pk_filepath_type" unique="PRIMARY_KEY" >
				<column name="filepath_type_id" />
			</index>
		</table>
		<table name="filetype" >
			<comment>Type of file (FASTA, FASTQ, SPECTRA, etc)</comment>
			<column name="filetype_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="type" type="varchar" jt="12" mandatory="y" />
			<index name="pk_filetype" unique="PRIMARY_KEY" >
				<column name="filetype_id" />
			</index>
		</table>
		<table name="investigation" >
			<comment>Overarching investigation information.
An investigation comprises one or more individual studies.</comment>
			<column name="investigation_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="name" type="varchar" jt="12" mandatory="y" />
			<column name="description" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[Describes the overarching goal of the investigation]]></comment>
			</column>
			<column name="contact_person_id" type="bigint" jt="-5" />
			<index name="pk_investigation" unique="PRIMARY_KEY" >
				<column name="investigation_id" />
			</index>
			<index name="idx_investigation" unique="NORMAL" >
				<column name="contact_person_id" />
			</index>
			<fk name="fk_investigation_study_person" to_schema="qiita" to_table="study_person" >
				<fk_column name="contact_person_id" pk="study_person_id" />
			</fk>
		</table>
		<table name="investigation_study" >
			<column name="investigation_id" type="bigint" jt="-5" mandatory="y" />
			<column name="study_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_investigation_study" unique="PRIMARY_KEY" >
				<column name="investigation_id" />
				<column name="study_id" />
			</index>
			<index name="idx_investigation_study_investigation" unique="NORMAL" >
				<column name="investigation_id" />
			</index>
			<index name="idx_investigation_study_study" unique="NORMAL" >
				<column name="study_id" />
			</index>
			<fk name="fk_investigation_study" to_schema="qiita" to_table="investigation" >
				<fk_column name="investigation_id" pk="investigation_id" />
			</fk>
			<fk name="fk_investigation_study_study" to_schema="qiita" to_table="study" >
				<fk_column name="study_id" pk="study_id" />
			</fk>
		</table>
		<table name="job" >
			<column name="job_id" type="bigserial" jt="-5" mandatory="y" >
				<comment><![CDATA[Unique identifier for job]]></comment>
			</column>
			<column name="data_type_id" type="bigint" jt="-5" mandatory="y" >
				<comment><![CDATA[What datatype (16s, metabolome, etc) job is run on.]]></comment>
			</column>
			<column name="job_status_id" type="bigint" length="10" jt="-5" mandatory="y" />
			<column name="command_id" type="bigint" length="100" jt="-5" mandatory="y" >
				<comment><![CDATA[The Qiime or other function being run (alpha diversity, etc)]]></comment>
			</column>
			<column name="options" type="varchar" jt="12" >
				<comment><![CDATA[Holds all options set for the job as a json string]]></comment>
			</column>
			<column name="log_id" type="bigint" jt="-5" >
				<comment><![CDATA[Reference to error if status is error]]></comment>
			</column>
			<index name="pk_job" unique="PRIMARY_KEY" >
				<column name="job_id" />
			</index>
			<index name="idx_job_command" unique="NORMAL" >
				<column name="command_id" />
			</index>
			<index name="idx_job_status" unique="NORMAL" >
				<column name="job_status_id" />
			</index>
			<index name="idx_job_type" unique="NORMAL" >
				<column name="data_type_id" />
			</index>
			<index name="idx_job" unique="NORMAL" >
				<column name="log_id" />
			</index>
			<fk name="fk_job_function" to_schema="qiita" to_table="command" >
				<fk_column name="command_id" pk="command_id" />
			</fk>
			<fk name="fk_job_job_status_id" to_schema="qiita" to_table="job_status" >
				<fk_column name="job_status_id" pk="job_status_id" />
			</fk>
			<fk name="fk_job_data_type" to_schema="qiita" to_table="data_type" >
				<fk_column name="data_type_id" pk="data_type_id" />
			</fk>
			<fk name="fk_job" to_schema="qiita" to_table="logging" >
				<fk_column name="log_id" pk="logging_id" />
			</fk>
		</table>
		<table name="job_results_filepath" >
			<comment>Holds connection between jobs and the result filepaths</comment>
			<column name="job_id" type="bigint" jt="-5" mandatory="y" />
			<column name="filepath_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_job_results_filepath" unique="PRIMARY_KEY" >
				<column name="job_id" />
				<column name="filepath_id" />
			</index>
			<index name="idx_job_results_filepath_0" unique="NORMAL" >
				<column name="job_id" />
			</index>
			<index name="idx_job_results_filepath_1" unique="NORMAL" >
				<column name="filepath_id" />
			</index>
			<fk name="fk_job_results_filepath" to_schema="qiita" to_table="job" >
				<fk_column name="job_id" pk="job_id" />
			</fk>
			<fk name="fk_job_results_filepath_0" to_schema="qiita" to_table="filepath" >
				<fk_column name="filepath_id" pk="filepath_id" />
			</fk>
		</table>
		<table name="job_status" >
			<column name="job_status_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="status" type="varchar" jt="12" mandatory="y" />
			<index name="pk_job_status" unique="PRIMARY_KEY" >
				<column name="job_status_id" />
			</index>
		</table>
		<table name="logging" >
			<column name="logging_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="time" type="timestamp" jt="93" mandatory="y" >
				<comment><![CDATA[Time the error was thrown]]></comment>
			</column>
			<column name="severity_id" type="integer" jt="4" mandatory="y" />
			<column name="msg" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[Error message thrown]]></comment>
			</column>
			<column name="information" type="varchar" jt="12" >
				<comment><![CDATA[Other applicable information (depending on error)]]></comment>
			</column>
			<index name="idx_logging_0" unique="NORMAL" >
				<column name="severity_id" />
			</index>
			<index name="pk_logging" unique="PRIMARY_KEY" >
				<column name="logging_id" />
			</index>
			<fk name="fk_logging_severity" to_schema="qiita" to_table="severity" >
				<fk_column name="severity_id" pk="severity_id" />
			</fk>
		</table>
		<table name="mixs_field_description" >
			<column name="column_name" type="varchar" jt="12" mandatory="y" />
			<column name="data_type" type="varchar" jt="12" mandatory="y" />
			<column name="desc_or_value" type="varchar" jt="12" mandatory="y" />
			<column name="definition" type="varchar" jt="12" mandatory="y" />
			<column name="min_length" type="integer" length="100" jt="4" />
			<column name="active" type="integer" jt="4" mandatory="y" />
			<index name="pk_mixs_field_description" unique="PRIMARY_KEY" >
				<column name="column_name" />
			</index>
		</table>
		<table name="ontology" >
			<column name="ontology_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="shortname" type="varchar" jt="12" mandatory="y" />
			<column name="fully_loaded" type="bool" jt="-7" mandatory="y" />
			<column name="fullname" type="varchar" jt="12" />
			<column name="query_url" type="varchar" jt="12" />
			<column name="source_url" type="varchar" jt="12" />
			<column name="definition" type="text" jt="12" />
			<column name="load_date" type="date" jt="91" mandatory="y" />
			<column name="version" type="varchar" jt="12" />
			<index name="pk_ontology" unique="PRIMARY_KEY" >
				<column name="ontology_id" />
			</index>
		</table>
		<table name="portal_type" >
			<comment>What portals are available to show a study in</comment>
			<column name="portal_type_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="portal" type="varchar" jt="12" mandatory="y" />
			<column name="description" type="varchar" jt="12" mandatory="y" />
			<index name="pk_portal_type" unique="PRIMARY_KEY" >
				<column name="portal_type_id" />
			</index>
		</table>
		<table name="prep_y" >
			<comment>Information on how raw data y was prepared (prep template)
Linked by y being raw_data_id from raw data table.</comment>
			<column name="sample_id" type="varchar" jt="12" mandatory="y" />
			<column name="data" type="bigint" jt="-5" >
				<comment><![CDATA[STUFFFFF]]></comment>
			</column>
			<index name="pk_prep_y" unique="PRIMARY_KEY" >
				<column name="sample_id" />
			</index>
		</table>
		<table name="preprocessed_data" >
			<column name="preprocessed_data_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="preprocessed_params_table" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[Name of table holding the params]]></comment>
			</column>
			<column name="preprocessed_params_id" type="bigint" jt="-5" mandatory="y" />
			<column name="submitted_to_insdc" type="bool" jt="-7" mandatory="y" />
			<column name="data_type_id" type="bigint" jt="-5" mandatory="y" />
			<index name="pk_preprocessed_data" unique="PRIMARY_KEY" >
				<column name="preprocessed_data_id" />
			</index>
			<index name="idx_preprocessed_data" unique="NORMAL" >
				<column name="data_type_id" />
			</index>
			<fk name="fk_preprocessed_data" to_schema="qiita" to_table="data_type" >
				<fk_column name="data_type_id" pk="data_type_id" />
			</fk>
		</table>
		<table name="preprocessed_filepath" >
			<column name="preprocessed_data_id" type="bigint" jt="-5" mandatory="y" />
			<column name="filepath_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_preprocessed_filepath" unique="PRIMARY_KEY" >
				<column name="preprocessed_data_id" />
				<column name="filepath_id" />
			</index>
			<index name="idx_preprocessed_filepath_0" unique="NORMAL" >
				<column name="preprocessed_data_id" />
			</index>
			<index name="idx_preprocessed_filepath_1" unique="NORMAL" >
				<column name="filepath_id" />
			</index>
			<fk name="fk_preprocessed_filepath" to_schema="qiita" to_table="preprocessed_data" >
				<fk_column name="preprocessed_data_id" pk="preprocessed_data_id" />
			</fk>
			<fk name="fk_preprocessed_filepath_0" to_schema="qiita" to_table="filepath" >
				<fk_column name="filepath_id" pk="filepath_id" />
			</fk>
		</table>
		<table name="preprocessed_processed_data" >
			<column name="preprocessed_data_id" type="bigint" jt="-5" mandatory="y" />
			<column name="processed_data_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_preprocessed_processed_data" unique="PRIMARY_KEY" >
				<column name="preprocessed_data_id" />
				<column name="processed_data_id" />
			</index>
			<index name="idx_preprocessed_processed_data_0" unique="NORMAL" >
				<column name="preprocessed_data_id" />
			</index>
			<index name="idx_preprocessed_processed_data_1" unique="NORMAL" >
				<column name="processed_data_id" />
			</index>
			<fk name="fk_preprocessed_processed_data" to_schema="qiita" to_table="preprocessed_data" >
				<fk_column name="preprocessed_data_id" pk="preprocessed_data_id" />
			</fk>
			<fk name="fk_preprocessed_processed_data_0" to_schema="qiita" to_table="processed_data" >
				<fk_column name="processed_data_id" pk="processed_data_id" />
			</fk>
		</table>
		<table name="preprocessed_sequence_454_params" >
			<comment>Parameters used for processing sequence data.</comment>
			<column name="preprocessed_params_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="trim_length" type="integer" jt="4" mandatory="y" />
			<index name="pk_preprocessed_sequence_454_params" unique="PRIMARY_KEY" >
				<column name="preprocessed_params_id" />
			</index>
		</table>
		<table name="preprocessed_sequence_illumina_params" >
			<comment>Parameters used for processing illumina sequence data.</comment>
			<column name="preprocessed_params_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="trim_length" type="integer" jt="4" mandatory="y" />
			<column name="max_bad_run_length" type="integer" jt="4" mandatory="y" >
				<defo>3</defo>
			</column>
			<column name="min_per_read_length_fraction" type="real" jt="7" mandatory="y" >
				<defo>0.75</defo>
			</column>
			<column name="sequence_max_n" type="integer" jt="4" mandatory="y" >
				<defo>0</defo>
			</column>
			<index name="pk_preprocessed_sequence_illumina_params" unique="PRIMARY_KEY" >
				<column name="preprocessed_params_id" />
			</index>
		</table>
		<table name="preprocessed_spectra_params" >
			<comment>Parameters used for processing spectra data.</comment>
			<column name="preprocessed_params_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="col" type="varchar" jt="12" />
			<index name="pk_preprocessed_spectra_params" unique="PRIMARY_KEY" >
				<column name="preprocessed_params_id" />
			</index>
		</table>
		<table name="processed_data" >
			<column name="processed_data_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="processed_params_table" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[Name of table holding processing params]]></comment>
			</column>
			<column name="processed_params_id" type="bigint" jt="-5" mandatory="y" >
				<comment><![CDATA[Link to a table with the parameters used to generate processed data]]></comment>
			</column>
			<column name="processed_date" type="timestamp" jt="93" mandatory="y" />
			<column name="data_type_id" type="bigint" jt="-5" mandatory="y" />
			<index name="pk_processed_data" unique="PRIMARY_KEY" >
				<column name="processed_data_id" />
			</index>
			<index name="idx_processed_data" unique="NORMAL" >
				<column name="data_type_id" />
			</index>
			<fk name="fk_processed_data" to_schema="qiita" to_table="data_type" >
				<fk_column name="data_type_id" pk="data_type_id" />
			</fk>
		</table>
		<table name="processed_filepath" >
			<column name="processed_data_id" type="bigint" jt="-5" mandatory="y" />
			<column name="filepath_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_processed_filepath" unique="PRIMARY_KEY" >
				<column name="processed_data_id" />
				<column name="filepath_id" />
			</index>
			<fk name="fk_processed_data_filepath" to_schema="qiita" to_table="processed_data" >
				<fk_column name="processed_data_id" pk="processed_data_id" />
			</fk>
			<fk name="fk_processed_data_filepath_0" to_schema="qiita" to_table="filepath" >
				<fk_column name="filepath_id" pk="filepath_id" />
			</fk>
		</table>
		<table name="processed_params_uclust" >
			<comment>Parameters used for processing data using method uclust</comment>
			<column name="processed_params_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="reference_id" type="bigint" jt="-5" mandatory="y" >
				<comment><![CDATA[What version of reference or type of reference used]]></comment>
			</column>
			<column name="similarity" type="float8" jt="6" mandatory="y" >
				<defo>0.97</defo>
			</column>
			<column name="enable_rev_strand_match" type="bool" jt="-7" mandatory="y" >
				<defo>TRUE</defo>
			</column>
			<column name="suppress_new_clusters" type="bool" jt="-7" mandatory="y" >
				<defo>TRUE</defo>
			</column>
			<index name="pk_processed_params_uclust" unique="PRIMARY_KEY" >
				<column name="processed_params_id" />
			</index>
			<index name="idx_processed_params_uclust" unique="NORMAL" >
				<column name="reference_id" />
			</index>
			<fk name="fk_processed_params_uclust" to_schema="qiita" to_table="reference" >
				<fk_column name="reference_id" pk="reference_id" />
			</fk>
		</table>
		<table name="qiita_user" >
			<comment>Holds all user information</comment>
			<column name="email" type="varchar" jt="12" mandatory="y" />
			<column name="user_level_id" type="integer" jt="4" mandatory="y" >
				<defo>5</defo>
				<comment><![CDATA[user level]]></comment>
			</column>
			<column name="password" type="varchar" jt="12" mandatory="y" />
			<column name="name" type="varchar" jt="12" />
			<column name="affiliation" type="varchar" jt="12" />
			<column name="address" type="varchar" jt="12" />
			<column name="phone" type="varchar" jt="12" />
			<column name="user_verify_code" type="varchar" jt="12" >
				<comment><![CDATA[Code for initial user email verification]]></comment>
			</column>
			<column name="pass_reset_code" type="varchar" jt="12" >
				<comment><![CDATA[Randomly generated code for password reset]]></comment>
			</column>
			<column name="pass_reset_timestamp" type="timestamp" jt="93" >
				<comment><![CDATA[Time the reset code was generated]]></comment>
			</column>
			<index name="pk_user" unique="PRIMARY_KEY" >
				<column name="email" />
			</index>
			<index name="idx_user" unique="NORMAL" >
				<column name="user_level_id" />
			</index>
			<fk name="fk_user_user_level" to_schema="qiita" to_table="user_level" update_action="restrict" >
				<fk_column name="user_level_id" pk="user_level_id" />
			</fk>
		</table>
		<table name="raw_data" >
			<column name="raw_data_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="filetype_id" type="bigint" jt="-5" mandatory="y" />
			<index name="pk_raw_data" unique="UNIQUE" >
				<column name="raw_data_id" />
			</index>
			<index name="idx_raw_data" unique="NORMAL" >
				<column name="filetype_id" />
			</index>
			<fk name="fk_raw_data_filetype" to_schema="qiita" to_table="filetype" >
				<fk_column name="filetype_id" pk="filetype_id" />
			</fk>
		</table>
		<table name="raw_data_prep_columns" >
			<comment>Holds the columns available for a given raw data prep</comment>
			<column name="raw_data_id" type="bigint" jt="-5" mandatory="y" />
			<column name="column_name" type="varchar" jt="12" mandatory="y" />
			<column name="column_type" type="varchar" jt="12" mandatory="y" />
			<index name="idx_raw_data_prep_columns" unique="PRIMARY_KEY" >
				<column name="raw_data_id" />
				<column name="column_name" />
				<column name="column_type" />
			</index>
			<index name="idx_prep_columns" unique="NORMAL" >
				<column name="raw_data_id" />
			</index>
			<fk name="fk_prep_columns_raw_data" to_schema="qiita" to_table="raw_data" >
				<fk_column name="raw_data_id" pk="raw_data_id" />
			</fk>
		</table>
		<table name="raw_filepath" >
			<column name="raw_data_id" type="bigint" jt="-5" mandatory="y" />
			<column name="filepath_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_raw_filepath" unique="PRIMARY_KEY" >
				<column name="raw_data_id" />
				<column name="filepath_id" />
			</index>
			<index name="idx_raw_filepath_0" unique="NORMAL" >
				<column name="filepath_id" />
			</index>
			<index name="idx_raw_filepath_1" unique="NORMAL" >
				<column name="raw_data_id" />
			</index>
			<fk name="fk_raw_filepath" to_schema="qiita" to_table="filepath" >
				<fk_column name="filepath_id" pk="filepath_id" />
			</fk>
			<fk name="fk_raw_filepath_0" to_schema="qiita" to_table="raw_data" >
				<fk_column name="raw_data_id" pk="raw_data_id" />
			</fk>
		</table>
		<table name="raw_preprocessed_data" >
			<column name="raw_data_id" type="bigint" jt="-5" mandatory="y" />
			<column name="preprocessed_data_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_raw_preprocessed_data" unique="PRIMARY_KEY" >
				<column name="raw_data_id" />
				<column name="preprocessed_data_id" />
			</index>
			<index name="idx_raw_preprocessed_data_0" unique="NORMAL" >
				<column name="raw_data_id" />
			</index>
			<index name="idx_raw_preprocessed_data_1" unique="NORMAL" >
				<column name="preprocessed_data_id" />
			</index>
			<fk name="fk_raw_preprocessed_data" to_schema="qiita" to_table="raw_data" >
				<fk_column name="raw_data_id" pk="raw_data_id" />
			</fk>
			<fk name="fk_raw_preprocessed_data_0" to_schema="qiita" to_table="preprocessed_data" >
				<fk_column name="preprocessed_data_id" pk="preprocessed_data_id" />
			</fk>
		</table>
		<table name="reference" >
			<column name="reference_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="reference_name" type="varchar" jt="12" mandatory="y" />
			<column name="reference_version" type="varchar" jt="12" />
			<column name="sequence_filepath" type="varchar" jt="12" mandatory="y" />
			<column name="taxonomy_filepath" type="varchar" jt="12" />
			<column name="tree_filepath" type="varchar" jt="12" />
			<index name="pk_reference" unique="PRIMARY_KEY" >
				<column name="reference_id" />
			</index>
		</table>
		<table name="relationship_type" >
			<column name="relationship_type_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="relationship_type" type="varchar" jt="12" mandatory="y" />
			<index name="pk_relationship_type" unique="PRIMARY_KEY" >
				<column name="relationship_type_id" />
			</index>
		</table>
		<table name="required_sample_info" >
			<comment>Required info for each sample. One row is one sample.</comment>
			<column name="study_id" type="bigint" jt="-5" mandatory="y" />
			<column name="sample_id" type="varchar" jt="12" mandatory="y" />
			<column name="physical_location" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[Where the sample itself is stored]]></comment>
			</column>
			<column name="has_physical_specimen" type="bool" jt="-7" mandatory="y" >
				<comment><![CDATA[Whether we have the full speciment or just DNA]]></comment>
			</column>
			<column name="has_extracted_data" type="bool" jt="-7" mandatory="y" />
			<column name="sample_type" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[Controlled vocabulary of sample types]]></comment>
			</column>
			<column name="required_sample_info_status_id" type="bigint" jt="-5" mandatory="y" >
				<comment><![CDATA[What step of the pipeline the samples are in]]></comment>
			</column>
			<column name="collection_timestamp" type="timestamp" jt="93" mandatory="y" />
			<column name="host_subject_id" type="varchar" jt="12" mandatory="y" />
			<column name="description" type="varchar" jt="12" mandatory="y" />
			<index name="idx_common_sample_information" unique="PRIMARY_KEY" >
				<column name="study_id" />
				<column name="sample_id" />
			</index>
			<index name="idx_required_sample_info" unique="NORMAL" >
				<column name="study_id" />
			</index>
			<index name="idx_required_sample_info_0" unique="NORMAL" >
				<column name="required_sample_info_status_id" />
			</index>
			<index name="pk_required_sample_info" unique="UNIQUE" >
				<column name="sample_id" />
			</index>
			<fk name="fk_required_sample_info_study" to_schema="qiita" to_table="study" >
				<fk_column name="study_id" pk="study_id" />
			</fk>
			<fk name="fk_required_sample_info" to_schema="qiita" to_table="required_sample_info_status" >
				<fk_column name="required_sample_info_status_id" pk="required_sample_info_status_id" />
			</fk>
		</table>
		<table name="required_sample_info_status" >
			<column name="required_sample_info_status_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="status" type="varchar" jt="12" />
			<index name="pk_sample_status" unique="PRIMARY_KEY" >
				<column name="required_sample_info_status_id" />
			</index>
		</table>
		<table name="sample_x" >
			<comment>data for samples in study x (sample template)
x is the study_id from study table

MAKE SURE sample_id IS FK TO sample_id IN required_sample_info TABLE</comment>
			<column name="sample_id" type="varchar" jt="12" mandatory="y" />
			<column name="description" type="varchar" jt="12" mandatory="y" />
			<column name="other_mapping_columns" type="varchar" jt="12" >
				<comment><![CDATA[Represents whatever other columns go with this study]]></comment>
			</column>
			<index name="pk_study_x_y" unique="PRIMARY_KEY" >
				<column name="sample_id" />
			</index>
		</table>
		<table name="severity" >
			<column name="severity_id" type="serial" jt="4" mandatory="y" />
			<column name="severity" type="varchar" jt="12" mandatory="y" />
			<index name="pk_severity" unique="PRIMARY_KEY" >
				<column name="severity_id" />
			</index>
		</table>
		<table name="study" >
			<column name="study_id" type="bigserial" jt="-5" mandatory="y" >
				<comment><![CDATA[Unique name for study]]></comment>
			</column>
			<column name="email" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[Email of study owner]]></comment>
			</column>
			<column name="study_status_id" type="bigint" jt="-5" mandatory="y" />
			<column name="emp_person_id" type="bigint" jt="-5" />
			<column name="first_contact" type="varchar" jt="12" mandatory="y" />
			<column name="funding" type="varchar" jt="12" />
			<column name="timeseries_type_id" type="bigint" jt="-5" mandatory="y" >
				<comment><![CDATA[What type of timeseries this study is (or is not)
Controlled Vocabulary]]></comment>
			</column>
			<column name="lab_person_id" type="bigint" jt="-5" />
			<column name="metadata_complete" type="bool" jt="-7" mandatory="y" />
			<column name="mixs_compliant" type="bool" jt="-7" mandatory="y" />
			<column name="most_recent_contact" type="varchar" jt="12" />
			<column name="number_samples_collected" type="integer" jt="4" mandatory="y" />
			<column name="number_samples_promised" type="integer" jt="4" mandatory="y" />
			<column name="portal_type_id" type="bigint" jt="-5" mandatory="y" />
			<column name="principal_investigator_id" type="bigint" jt="-5" mandatory="y" />
			<column name="reprocess" type="bool" jt="-7" mandatory="y" />
			<column name="spatial_series" type="bool" jt="-7" />
			<column name="study_title" type="varchar" jt="12" mandatory="y" />
			<column name="study_alias" type="varchar" jt="12" mandatory="y" />
			<column name="study_description" type="text" jt="12" mandatory="y" />
			<column name="study_abstract" type="text" jt="12" mandatory="y" />
			<column name="vamps_id" type="varchar" jt="12" />
			<index name="pk_study" unique="PRIMARY_KEY" >
				<column name="study_id" />
			</index>
			<index name="idx_study" unique="NORMAL" >
				<column name="email" />
			</index>
			<index name="idx_study_0" unique="NORMAL" >
				<column name="study_status_id" />
			</index>
			<index name="idx_study_1" unique="NORMAL" >
				<column name="emp_person_id" />
			</index>
			<index name="idx_study_2" unique="NORMAL" >
				<column name="lab_person_id" />
			</index>
			<index name="idx_study_3" unique="NORMAL" >
				<column name="principal_investigator_id" />
			</index>
			<index name="idx_study_4" unique="NORMAL" >
				<column name="timeseries_type_id" />
			</index>
			<index name="idx_study_5" unique="NORMAL" >
				<column name="portal_type_id" />
			</index>
			<fk name="fk_study_user" to_schema="qiita" to_table="qiita_user" >
				<fk_column name="email" pk="email" />
			</fk>
			<fk name="fk_study_study_status" to_schema="qiita" to_table="study_status" >
				<fk_column name="study_status_id" pk="study_status_id" />
			</fk>
			<fk name="fk_study_study_emp_person" to_schema="qiita" to_table="study_person" >
				<fk_column name="emp_person_id" pk="study_person_id" />
			</fk>
			<fk name="fk_study_study_lab_person" to_schema="qiita" to_table="study_person" >
				<fk_column name="lab_person_id" pk="study_person_id" />
			</fk>
			<fk name="fk_study_study_pi_person" to_schema="qiita" to_table="study_person" >
				<fk_column name="principal_investigator_id" pk="study_person_id" />
			</fk>
			<fk name="fk_study_timeseries_type" to_schema="qiita" to_table="timeseries_type" >
				<fk_column name="timeseries_type_id" pk="timeseries_type_id" />
			</fk>
			<fk name="fk_study" to_schema="qiita" to_table="portal_type" >
				<fk_column name="portal_type_id" pk="portal_type_id" />
			</fk>
		</table>
		<table name="study_experimental_factor" >
			<comment>EFO ontological link of experimental factors to studies</comment>
			<column name="study_id" type="bigint" jt="-5" mandatory="y" />
			<column name="efo_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_study_experimental_factor" unique="PRIMARY_KEY" >
				<column name="study_id" />
				<column name="efo_id" />
			</index>
			<index name="idx_study_experimental_factor_0" unique="NORMAL" >
				<column name="study_id" />
			</index>
			<fk name="fk_study_experimental_factor" to_schema="qiita" to_table="study" >
				<fk_column name="study_id" pk="study_id" />
			</fk>
		</table>
		<table name="study_person" >
			<comment>Contact information for the various people involved in a study</comment>
			<column name="study_person_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="name" type="varchar" jt="12" mandatory="y" />
			<column name="email" type="varchar" jt="12" mandatory="y" />
			<column name="address" type="varchar" length="100" jt="12" />
			<column name="phone" type="varchar" jt="12" />
			<index name="pk_study_person" unique="PRIMARY_KEY" >
				<column name="study_person_id" />
			</index>
		</table>
		<table name="study_pmid" >
			<comment>Links a study to all PMIDs for papers created from study</comment>
			<column name="study_id" type="bigint" jt="-5" mandatory="y" />
			<column name="pmid" type="varchar" jt="12" mandatory="y" />
			<index name="idx_study_pmid" unique="PRIMARY_KEY" >
				<column name="study_id" />
				<column name="pmid" />
			</index>
			<index name="idx_study_pmid_0" unique="NORMAL" >
				<column name="study_id" />
			</index>
			<fk name="fk_study_pmid_study" to_schema="qiita" to_table="study" >
				<fk_column name="study_id" pk="study_id" />
			</fk>
		</table>
		<table name="study_preprocessed_data" >
			<column name="study_id" type="bigint" jt="-5" mandatory="y" />
			<column name="preprocessed_data_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_study_preprocessed_data" unique="PRIMARY_KEY" >
				<column name="study_id" />
				<column name="preprocessed_data_id" />
			</index>
			<index name="idx_study_preprocessed_data_0" unique="NORMAL" >
				<column name="study_id" />
			</index>
			<index name="idx_study_preprocessed_data_1" unique="NORMAL" >
				<column name="preprocessed_data_id" />
			</index>
			<fk name="fk_study_preprocessed_data" to_schema="qiita" to_table="study" >
				<fk_column name="study_id" pk="study_id" />
			</fk>
			<fk name="fk_study_preprocessed_data_0" to_schema="qiita" to_table="preprocessed_data" >
				<fk_column name="preprocessed_data_id" pk="preprocessed_data_id" />
			</fk>
		</table>
		<table name="study_processed_data" >
			<column name="study_id" type="bigint" jt="-5" mandatory="y" />
			<column name="processed_data_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_study_processed_data" unique="PRIMARY_KEY" >
				<column name="study_id" />
				<column name="processed_data_id" />
			</index>
			<index name="idx_study_processed_data_0" unique="NORMAL" >
				<column name="study_id" />
			</index>
			<index name="pk_study_processed_data" unique="UNIQUE" >
				<column name="processed_data_id" />
			</index>
			<fk name="fk_study_processed_data" to_schema="qiita" to_table="study" >
				<fk_column name="study_id" pk="study_id" />
			</fk>
			<fk name="fk_study_processed_data_0" to_schema="qiita" to_table="processed_data" >
				<fk_column name="processed_data_id" pk="processed_data_id" />
			</fk>
		</table>
		<table name="study_raw_data" >
			<comment>links study to its raw data</comment>
			<column name="study_id" type="bigint" jt="-5" mandatory="y" />
			<column name="raw_data_id" type="bigint" jt="-5" mandatory="y" />
			<index name="idx_study_raw_data" unique="NORMAL" >
				<column name="study_id" />
			</index>
			<index name="idx_study_raw_data_0" unique="PRIMARY_KEY" >
				<column name="study_id" />
				<column name="raw_data_id" />
			</index>
			<fk name="fk_study_raw_data_study" to_schema="qiita" to_table="study" >
				<fk_column name="study_id" pk="study_id" />
			</fk>
			<fk name="fk_study_raw_data_raw_data" to_schema="qiita" to_table="raw_data" >
				<fk_column name="raw_data_id" pk="raw_data_id" />
			</fk>
		</table>
		<table name="study_sample_columns" >
			<comment>Holds information on which metadata columns are available for the study sample template</comment>
			<column name="study_id" type="bigint" jt="-5" mandatory="y" />
			<column name="column_name" type="varchar" length="100" jt="12" mandatory="y" />
			<column name="column_type" type="varchar" jt="12" mandatory="y" />
			<index name="idx_study_mapping_columns" unique="PRIMARY_KEY" >
				<column name="study_id" />
				<column name="column_name" />
				<column name="column_type" />
			</index>
			<index name="idx_study_mapping_columns_study_id" unique="NORMAL" >
				<column name="study_id" />
			</index>
			<fk name="fk_study_mapping_columns_study" to_schema="qiita" to_table="study" >
				<fk_column name="study_id" pk="study_id" />
			</fk>
		</table>
		<table name="study_status" >
			<column name="study_status_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="status" type="varchar" jt="12" mandatory="y" />
			<column name="description" type="varchar" jt="12" mandatory="y" />
			<index name="pk_study_status" unique="PRIMARY_KEY" >
				<column name="study_status_id" />
			</index>
		</table>
		<table name="study_users" >
			<comment>Links shared studies to users they are shared with</comment>
			<column name="study_id" type="bigint" jt="-5" mandatory="y" />
			<column name="email" type="varchar" jt="12" mandatory="y" />
			<index name="idx_study_users" unique="PRIMARY_KEY" >
				<column name="study_id" />
				<column name="email" />
			</index>
			<index name="idx_study_users_0" unique="NORMAL" >
				<column name="study_id" />
			</index>
			<index name="idx_study_users_1" unique="NORMAL" >
				<column name="email" />
			</index>
			<fk name="fk_study_users_study" to_schema="qiita" to_table="study" >
				<fk_column name="study_id" pk="study_id" />
			</fk>
			<fk name="fk_study_users_user" to_schema="qiita" to_table="qiita_user" >
				<fk_column name="email" pk="email" />
			</fk>
		</table>
		<table name="term" >
			<column name="term_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="ontology_id" type="bigint" jt="-5" mandatory="y" />
			<column name="term_name" type="varchar" jt="12" mandatory="y" />
			<column name="identifier" type="varchar" jt="12" />
			<column name="definition" type="varchar" jt="12" />
			<column name="namespace" type="varchar" jt="12" />
			<column name="is_obsolete" type="bool" jt="-7" mandatory="y" >
				<defo>&#039;false&#039;</defo>
			</column>
			<column name="is_root_term" type="bool" jt="-7" mandatory="y" />
			<column name="is_leaf" type="bool" jt="-7" mandatory="y" />
			<index name="pk_term" unique="PRIMARY_KEY" >
				<column name="term_id" />
			</index>
			<index name="idx_term" unique="UNIQUE" >
				<column name="ontology_id" />
			</index>
			<fk name="fk_term_ontology" to_schema="qiita" to_table="ontology" >
				<fk_column name="ontology_id" pk="ontology_id" />
			</fk>
		</table>
		<table name="term_path" >
			<column name="term_path_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="subject_term_id" type="bigint" jt="-5" mandatory="y" />
			<column name="predicate_term_id" type="bigint" jt="-5" mandatory="y" />
			<column name="object_term_id" type="bigint" jt="-5" mandatory="y" />
			<column name="ontology_id" type="bigint" jt="-5" mandatory="y" />
			<column name="relationship_type_id" type="integer" jt="4" mandatory="y" />
			<column name="distance" type="integer" jt="4" />
			<index name="pk_term_path" unique="PRIMARY_KEY" >
				<column name="term_path_id" />
			</index>
			<index name="idx_term_path" unique="NORMAL" >
				<column name="ontology_id" />
			</index>
			<index name="idx_term_path_relatonship" unique="NORMAL" >
				<column name="relationship_type_id" />
			</index>
			<index name="idx_term_path_subject" unique="NORMAL" >
				<column name="subject_term_id" />
			</index>
			<index name="idx_term_path_predicate" unique="NORMAL" >
				<column name="predicate_term_id" />
			</index>
			<index name="idx_term_path_object" unique="NORMAL" >
				<column name="object_term_id" />
			</index>
			<fk name="fk_term_path_ontology" to_schema="qiita" to_table="ontology" >
				<fk_column name="ontology_id" pk="ontology_id" />
			</fk>
			<fk name="fk_term_path_relationship_type" to_schema="qiita" to_table="relationship_type" >
				<fk_column name="relationship_type_id" pk="relationship_type_id" />
			</fk>
			<fk name="fk_term_path_term_subject" to_schema="qiita" to_table="term" >
				<fk_column name="subject_term_id" pk="term_id" />
			</fk>
			<fk name="fk_term_path_term_predicate" to_schema="qiita" to_table="term" >
				<fk_column name="predicate_term_id" pk="term_id" />
			</fk>
			<fk name="fk_term_path_term_object" to_schema="qiita" to_table="term" >
				<fk_column name="object_term_id" pk="term_id" />
			</fk>
		</table>
		<table name="term_relationship" >
			<column name="term_relationship_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="subject_term_id" type="bigint" jt="-5" mandatory="y" />
			<column name="predicate_term_id" type="bigint" jt="-5" mandatory="y" />
			<column name="object_term_id" type="bigint" jt="-5" mandatory="y" />
			<column name="ontology_id" type="bigint" jt="-5" mandatory="y" />
			<index name="pk_term_relationship" unique="PRIMARY_KEY" >
				<column name="term_relationship_id" />
			</index>
			<index name="idx_term_relationship_subject" unique="NORMAL" >
				<column name="subject_term_id" />
			</index>
			<index name="idx_term_relationship_predicate" unique="NORMAL" >
				<column name="predicate_term_id" />
			</index>
			<index name="idx_term_relationship_object" unique="NORMAL" >
				<column name="object_term_id" />
			</index>
			<index name="idx_term_relationship_ontology" unique="NORMAL" >
				<column name="ontology_id" />
			</index>
			<fk name="fk_term_relationship_subj_term" to_schema="qiita" to_table="term" >
				<fk_column name="subject_term_id" pk="term_id" />
			</fk>
			<fk name="fk_term_relationship_pred_term" to_schema="qiita" to_table="term" >
				<fk_column name="predicate_term_id" pk="term_id" />
			</fk>
			<fk name="fk_term_relationship_obj_term" to_schema="qiita" to_table="term" >
				<fk_column name="object_term_id" pk="term_id" />
			</fk>
			<fk name="fk_term_relationship_ontology" to_schema="qiita" to_table="ontology" >
				<fk_column name="ontology_id" pk="ontology_id" />
			</fk>
		</table>
		<table name="term_synonym" >
			<column name="synonym_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="term_id" type="bigint" jt="-5" mandatory="y" />
			<column name="synonym_value" type="varchar" jt="12" mandatory="y" />
			<column name="synonym_type_id" type="bigint" jt="-5" mandatory="y" />
			<index name="pk_term_synonym" unique="PRIMARY_KEY" >
				<column name="synonym_id" />
			</index>
			<index name="idx_term_synonym" unique="NORMAL" >
				<column name="term_id" />
			</index>
			<fk name="fk_term_synonym_term" to_schema="qiita" to_table="term" >
				<fk_column name="term_id" pk="term_id" />
			</fk>
			<fk name="fk_term_synonym_type_term" to_schema="qiita" to_table="term" >
				<fk_column name="synonym_id" pk="term_id" />
			</fk>
		</table>
		<table name="timeseries_type" >
			<column name="timeseries_type_id" type="bigserial" jt="-5" mandatory="y" />
			<column name="timeseries_type" type="varchar" jt="12" mandatory="y" />
			<index name="pk_timeseries_type" unique="PRIMARY_KEY" >
				<column name="timeseries_type_id" />
			</index>
		</table>
		<table name="user_level" >
			<comment>Holds available user levels</comment>
			<column name="user_level_id" type="serial" jt="4" mandatory="y" />
			<column name="name" type="varchar" jt="12" mandatory="y" >
				<comment><![CDATA[One of the user levels (admin, user, guest, etc)]]></comment>
			</column>
			<column name="description" type="text" jt="12" mandatory="y" />
			<index name="pk_user_level" unique="PRIMARY_KEY" >
				<column name="user_level_id" />
			</index>
		</table>
	</schema>
	<connector name="PostgreSQL" database="PostgreSQL" driver_class="org.postgresql.Driver" driver_jar="postgresql-9.2-1003.jdbc3.jar" host="localhost" port="5432" instance="qiita_test" user="defaultuser" passwd="ZGVmYXVsdHBhc3N3b3Jk" schema_mapping="" />
	<layout id="Layout669806" name="qiita" show_relation_columns="y" >
		<entity schema="qiita" name="term_synonym" color="d0def5" x="525" y="1875" />
		<entity schema="qiita" name="controlled_vocab_values" color="d0def5" x="45" y="1530" />
		<entity schema="qiita" name="controlled_vocabularies" color="d0def5" x="45" y="1320" />
		<entity schema="qiita" name="severity" color="c0d4f3" x="1500" y="1200" />
		<entity schema="qiita" name="study_person" color="c0d4f3" x="2040" y="90" />
		<entity schema="qiita" name="investigation" color="c0d4f3" x="2040" y="240" />
		<entity schema="qiita" name="investigation_study" color="c0d4f3" x="2040" y="390" />
		<entity schema="qiita" name="study_status" color="c0d4f3" x="2040" y="495" />
		<entity schema="qiita" name="study_experimental_factor" color="c0d4f3" x="2025" y="600" />
		<entity schema="qiita" name="study_pmid" color="c0d4f3" x="2025" y="690" />
		<entity schema="qiita" name="analysis_status" color="d0def5" x="45" y="810" />
		<entity schema="qiita" name="analysis" color="d0def5" x="225" y="705" />
		<entity schema="qiita" name="job_results_filepath" color="c0d4f3" x="405" y="840" />
		<entity schema="qiita" name="job" color="d0def5" x="405" y="990" />
		<entity schema="qiita" name="analysis_job" color="d0def5" x="285" y="915" />
		<entity schema="qiita" name="analysis_chain" color="c0d4f3" x="60" y="915" />
		<entity schema="qiita" name="job_status" color="d0def5" x="210" y="1005" />
		<entity schema="qiita" name="column_controlled_vocabularies" color="d0def5" x="270" y="1320" />
		<entity schema="qiita" name="mixs_field_description" color="d0def5" x="300" y="1485" />
		<entity schema="qiita" name="column_ontology" color="d0def5" x="285" y="1710" />
		<entity schema="qiita" name="term_relationship" color="d0def5" x="525" y="1515" />
		<entity schema="qiita" name="term_path" color="d0def5" x="990" y="1320" />
		<entity schema="qiita" name="ontology" color="d0def5" x="765" y="1320" />
		<entity schema="qiita" name="term" color="d0def5" x="795" y="1620" />
		<entity schema="qiita" name="annotation" color="d0def5" x="960" y="1860" />
		<entity schema="qiita" name="dbxref" color="d0def5" x="795" y="1845" />
		<entity schema="qiita" name="relationship_type" color="d0def5" x="975" y="1665" />
		<entity schema="qiita" name="analysis_users" color="d0def5" x="60" y="720" />
		<entity schema="qiita" name="user_level" color="d0def5" x="165" y="60" />
		<entity schema="qiita" name="qiita_user" color="d0def5" x="330" y="75" />
		<entity schema="qiita" name="filepath_type" color="c0d4f3" x="600" y="885" />
		<entity schema="qiita" name="checksum_algorithm" color="b2cdf7" x="750" y="885" />
		<entity schema="qiita" name="data_type" color="d0def5" x="690" y="1005" />
		<entity schema="qiita" name="filepath" color="c0d4f3" x="660" y="675" />
		<entity schema="qiita" name="study_preprocessed_data" color="c0d4f3" x="1485" y="705" />
		<entity schema="qiita" name="study" color="d0def5" x="1755" y="45" />
		<entity schema="qiita" name="study_users" color="d0def5" x="1005" y="45" />
		<entity schema="qiita" name="required_sample_info" color="d0def5" x="1350" y="105" />
		<entity schema="qiita" name="sample_x" color="d0def5" x="1575" y="150" />
		<entity schema="qiita" name="study_sample_columns" color="d0def5" x="1575" y="270" />
		<entity schema="qiita" name="required_sample_info_status" color="c0d4f3" x="1530" y="390" />
		<entity schema="qiita" name="prep_y" color="d0def5" x="1020" y="195" />
		<entity schema="qiita" name="common_prep_info" color="d0def5" x="1020" y="285" />
		<entity schema="qiita" name="emp_status" color="c0d4f3" x="1155" y="195" />
		<entity schema="qiita" name="raw_data_prep_columns" color="d0def5" x="1350" y="375" />
		<entity schema="qiita" name="filetype" color="d0def5" x="1230" y="375" />
		<entity schema="qiita" name="raw_filepath" color="c0d4f3" x="1020" y="480" />
		<entity schema="qiita" name="preprocessed_processed_data" color="b2cdf7" x="1215" y="825" />
		<entity schema="qiita" name="study_raw_data" color="d0def5" x="1515" y="495" />
		<entity schema="qiita" name="timeseries_type" color="c0d4f3" x="1620" y="600" />
		<entity schema="qiita" name="portal_type" color="c0d4f3" x="1845" y="720" />
		<entity schema="qiita" name="raw_data" color="d0def5" x="1230" y="480" />
		<entity schema="qiita" name="raw_preprocessed_data" color="b2cdf7" x="1230" y="585" />
		<entity schema="qiita" name="processed_filepath" color="c0d4f3" x="1005" y="930" />
		<entity schema="qiita" name="command" color="d0def5" x="210" y="1095" />
		<entity schema="qiita" name="logging" color="c0d4f3" x="1365" y="1200" />
		<entity schema="qiita" name="processed_params_uclust" color="d0def5" x="2025" y="795" />
		<entity schema="qiita" name="reference" color="c0d4f3" x="2070" y="945" />
		<entity schema="qiita" name="preprocessed_spectra_params" color="d0def5" x="1830" y="825" />
		<entity schema="qiita" name="preprocessed_sequence_454_params" color="c0d4f3" x="1815" y="915" />
		<entity schema="qiita" name="preprocessed_sequence_illumina_params" color="d0def5" x="1800" y="1005" />
		<entity schema="qiita" name="study_processed_data" color="b2cdf7" x="1455" y="930" />
		<entity schema="qiita" name="command_data_type" color="c0d4f3" x="390" y="1155" />
		<entity schema="qiita" name="preprocessed_data" color="c0d4f3" x="1200" y="690" />
		<entity schema="qiita" name="processed_data" color="d0def5" x="1215" y="930" />
		<entity schema="qiita" name="preprocessed_filepath" color="c0d4f3" x="990" y="690" />
		<entity schema="qiita" name="analysis_workflow" color="c0d4f3" x="390" y="630" />
		<entity schema="qiita" name="analysis_sample" color="d0def5" x="45" y="1155" />
		<entity schema="qiita" name="analysis_filepath" color="c0d4f3" x="405" y="720" />
		<group name="Group_analyses" color="c4e0f9" >
			<comment>analysis tables</comment>
			<entity schema="qiita" name="analysis" />
			<entity schema="qiita" name="analysis_job" />
			<entity schema="qiita" name="job" />
			<entity schema="qiita" name="command" />
			<entity schema="qiita" name="analysis_users" />
			<entity schema="qiita" name="analysis_status" />
			<entity schema="qiita" name="job_status" />
			<entity schema="qiita" name="analysis_sample" />
			<entity schema="qiita" name="analysis_chain" />
			<entity schema="qiita" name="analysis_filepath" />
			<entity schema="qiita" name="job_results_filepath" />
			<entity schema="qiita" name="command_data_type" />
			<entity schema="qiita" name="analysis_workflow" />
		</group>
		<group name="Group_users" color="ffff99" >
			<entity schema="qiita" name="user_level" />
			<entity schema="qiita" name="qiita_user" />
		</group>
		<group name="Group_study" color="99ff99" >
			<entity schema="qiita" name="study" />
			<entity schema="qiita" name="study_users" />
			<entity schema="qiita" name="study_sample_columns" />
			<entity schema="qiita" name="raw_data" />
			<entity schema="qiita" name="filetype" />
			<entity schema="qiita" name="study_raw_data" />
			<entity schema="qiita" name="sample_x" />
			<entity schema="qiita" name="preprocessed_spectra_params" />
			<entity schema="qiita" name="preprocessed_sequence_illumina_params" />
			<entity schema="qiita" name="required_sample_info" />
			<entity schema="qiita" name="prep_y" />
			<entity schema="qiita" name="raw_data_prep_columns" />
			<entity schema="qiita" name="processed_data" />
			<entity schema="qiita" name="processed_params_uclust" />
			<entity schema="qiita" name="common_prep_info" />
			<entity schema="qiita" name="study_experimental_factor" />
			<entity schema="qiita" name="study_pmid" />
			<entity schema="qiita" name="investigation_study" />
			<entity schema="qiita" name="investigation" />
			<entity schema="qiita" name="preprocessed_sequence_454_params" />
			<entity schema="qiita" name="preprocessed_data" />
			<entity schema="qiita" name="emp_status" />
			<entity schema="qiita" name="study_status" />
			<entity schema="qiita" name="study_person" />
			<entity schema="qiita" name="timeseries_type" />
			<entity schema="qiita" name="required_sample_info_status" />
			<entity schema="qiita" name="preprocessed_filepath" />
			<entity schema="qiita" name="raw_filepath" />
			<entity schema="qiita" name="processed_filepath" />
			<entity schema="qiita" name="study_preprocessed_data" />
			<entity schema="qiita" name="reference" />
			<entity schema="qiita" name="raw_preprocessed_data" />
			<entity schema="qiita" name="preprocessed_processed_data" />
			<entity schema="qiita" name="study_processed_data" />
		</group>
		<group name="Group_vocabularies" color="00ffcc" >
			<entity schema="qiita" name="controlled_vocabularies" />
			<entity schema="qiita" name="controlled_vocab_values" />
			<entity schema="qiita" name="column_controlled_vocabularies" />
			<entity schema="qiita" name="mixs_field_description" />
			<entity schema="qiita" name="column_ontology" />
		</group>
		<group name="Group_ontology" color="ff99ff" >
			<entity schema="qiita" name="ontology" />
			<entity schema="qiita" name="term" />
			<entity schema="qiita" name="relationship_type" />
			<entity schema="qiita" name="term_path" />
			<entity schema="qiita" name="term_relationship" />
			<entity schema="qiita" name="term_synonym" />
			<entity schema="qiita" name="dbxref" />
			<entity schema="qiita" name="annotation" />
		</group>
		<group name="Group_logging" color="c4e0f9" >
			<entity schema="qiita" name="logging" />
			<entity schema="qiita" name="severity" />
		</group>
		<group name="Group_filepaths" color="c4e0f9" >
			<entity schema="qiita" name="filepath" />
			<entity schema="qiita" name="filepath_type" />
			<entity schema="qiita" name="checksum_algorithm" />
		</group>
		<script name="Sql" id="SQL2803273" >
			<string><![CDATA[CREATE SCHEMA qiita;

CREATE TABLE qiita.analysis_status ( 
	analysis_status_id   bigserial  NOT NULL,
	status               varchar  NOT NULL,
	CONSTRAINT pk_analysis_status PRIMARY KEY ( analysis_status_id )
 );

CREATE TABLE qiita.checksum_algorithm ( 
	checksum_algorithm_id bigserial  NOT NULL,
	name                 varchar  NOT NULL,
	CONSTRAINT pk_checksum_algorithm PRIMARY KEY ( checksum_algorithm_id )
 );

CREATE TABLE qiita.command ( 
	command_id           bigserial  NOT NULL,
	name                 varchar  NOT NULL,
	command              varchar  NOT NULL,
	input                varchar  NOT NULL,
	required             varchar  NOT NULL,
	optional             varchar  NOT NULL,
	output               varchar  NOT NULL,
	CONSTRAINT pk_command PRIMARY KEY ( command_id )
 );

COMMENT ON TABLE qiita.command IS 'Available commands for jobs';

COMMENT ON COLUMN qiita.command.command_id IS 'Unique identifier for function';

COMMENT ON COLUMN qiita.command.command IS 'What command to call to run this function';

COMMENT ON COLUMN qiita.command.input IS 'JSON of input options for the command';

COMMENT ON COLUMN qiita.command.required IS 'JSON of required options for the command';

COMMENT ON COLUMN qiita.command.optional IS 'JSON of optional options for command';

COMMENT ON COLUMN qiita.command.output IS 'JSON of output options for the command';

CREATE TABLE qiita.controlled_vocabularies ( 
	controlled_vocab_id  bigserial  NOT NULL,
	vocab_name           varchar  NOT NULL,
	CONSTRAINT pk_controlled_vocabularies PRIMARY KEY ( controlled_vocab_id )
 );

CREATE TABLE qiita.data_type ( 
	data_type_id         bigserial  NOT NULL,
	data_type            varchar  NOT NULL,
	CONSTRAINT pk_data_type PRIMARY KEY ( data_type_id )
 );

COMMENT ON COLUMN qiita.data_type.data_type IS 'Data type (16S, metabolome, etc) the job will use';

CREATE TABLE qiita.emp_status ( 
	emp_status_id        bigserial  NOT NULL,
	emp_status           varchar  NOT NULL,
	CONSTRAINT pk_emp_status PRIMARY KEY ( emp_status_id )
 );

COMMENT ON TABLE qiita.emp_status IS 'All possible statuses for projects relating to EMP. Whether they are part of, processed in accordance to, or not part of EMP.';

CREATE TABLE qiita.filepath_type ( 
	filepath_type_id     bigserial  NOT NULL,
	filepath_type        varchar  ,
	CONSTRAINT pk_filepath_type PRIMARY KEY ( filepath_type_id )
 );

CREATE TABLE qiita.filetype ( 
	filetype_id          bigserial  NOT NULL,
	type                 varchar  NOT NULL,
	CONSTRAINT pk_filetype PRIMARY KEY ( filetype_id )
 );

COMMENT ON TABLE qiita.filetype IS 'Type of file (FASTA, FASTQ, SPECTRA, etc)';

CREATE TABLE qiita.job_status ( 
	job_status_id        bigserial  NOT NULL,
	status               varchar  NOT NULL,
	CONSTRAINT pk_job_status PRIMARY KEY ( job_status_id )
 );

CREATE TABLE qiita.mixs_field_description ( 
	column_name          varchar  NOT NULL,
	data_type            varchar  NOT NULL,
	desc_or_value        varchar  NOT NULL,
	definition           varchar  NOT NULL,
	min_length           integer  ,
	active               integer  NOT NULL,
	CONSTRAINT pk_mixs_field_description PRIMARY KEY ( column_name )
 );

CREATE TABLE qiita.ontology ( 
	ontology_id          bigserial  NOT NULL,
	shortname            varchar  NOT NULL,
	fully_loaded         bool  NOT NULL,
	fullname             varchar  ,
	query_url            varchar  ,
	source_url           varchar  ,
	definition           text  ,
	load_date            date  NOT NULL,
	version              varchar  ,
	CONSTRAINT pk_ontology PRIMARY KEY ( ontology_id )
 );

CREATE TABLE qiita.portal_type ( 
	portal_type_id       bigserial  NOT NULL,
	portal               varchar  NOT NULL,
	description          varchar  NOT NULL,
	CONSTRAINT pk_portal_type PRIMARY KEY ( portal_type_id )
 );

COMMENT ON TABLE qiita.portal_type IS 'What portals are available to show a study in';

CREATE TABLE qiita.preprocessed_data ( 
	preprocessed_data_id bigserial  NOT NULL,
	preprocessed_params_table varchar  NOT NULL,
	preprocessed_params_id bigint  NOT NULL,
	submitted_to_insdc   bool  NOT NULL,
	data_type_id         bigint  NOT NULL,
	CONSTRAINT pk_preprocessed_data PRIMARY KEY ( preprocessed_data_id ),
	CONSTRAINT fk_preprocessed_data FOREIGN KEY ( data_type_id ) REFERENCES qiita.data_type( data_type_id )    
 );

CREATE INDEX idx_preprocessed_data ON qiita.preprocessed_data ( data_type_id );

COMMENT ON COLUMN qiita.preprocessed_data.preprocessed_params_table IS 'Name of table holding the params';

CREATE TABLE qiita.preprocessed_sequence_454_params ( 
	preprocessed_params_id bigserial  NOT NULL,
	trim_length          integer  NOT NULL,
	CONSTRAINT pk_preprocessed_sequence_454_params PRIMARY KEY ( preprocessed_params_id )
 );

COMMENT ON TABLE qiita.preprocessed_sequence_454_params IS 'Parameters used for processing sequence data.';

CREATE TABLE qiita.preprocessed_sequence_illumina_params ( 
	preprocessed_params_id bigserial  NOT NULL,
	trim_length          integer  NOT NULL,
	max_bad_run_length   integer DEFAULT 3 NOT NULL,
	min_per_read_length_fraction real DEFAULT 0.75 NOT NULL,
	sequence_max_n       integer DEFAULT 0 NOT NULL,
	CONSTRAINT pk_preprocessed_sequence_illumina_params PRIMARY KEY ( preprocessed_params_id )
 );

COMMENT ON TABLE qiita.preprocessed_sequence_illumina_params IS 'Parameters used for processing illumina sequence data.';

CREATE TABLE qiita.preprocessed_spectra_params ( 
	preprocessed_params_id bigserial  NOT NULL,
	col                  varchar  ,
	CONSTRAINT pk_preprocessed_spectra_params PRIMARY KEY ( preprocessed_params_id )
 );

COMMENT ON TABLE qiita.preprocessed_spectra_params IS 'Parameters used for processing spectra data.';

CREATE TABLE qiita.processed_data ( 
	processed_data_id    bigserial  NOT NULL,
	processed_params_table varchar  NOT NULL,
	processed_params_id  bigint  NOT NULL,
	processed_date       timestamp  NOT NULL,
	data_type_id         bigint  NOT NULL,
	CONSTRAINT pk_processed_data PRIMARY KEY ( processed_data_id ),
	CONSTRAINT fk_processed_data FOREIGN KEY ( data_type_id ) REFERENCES qiita.data_type( data_type_id )    
 );

CREATE INDEX idx_processed_data ON qiita.processed_data ( data_type_id );

COMMENT ON COLUMN qiita.processed_data.processed_params_table IS 'Name of table holding processing params';

COMMENT ON COLUMN qiita.processed_data.processed_params_id IS 'Link to a table with the parameters used to generate processed data';

CREATE TABLE qiita.raw_data ( 
	raw_data_id          bigserial  NOT NULL,
	filetype_id          bigint  NOT NULL,
	CONSTRAINT pk_raw_data UNIQUE ( raw_data_id ) ,
	CONSTRAINT fk_raw_data_filetype FOREIGN KEY ( filetype_id ) REFERENCES qiita.filetype( filetype_id )    
 );

CREATE INDEX idx_raw_data ON qiita.raw_data ( filetype_id );

CREATE TABLE qiita.raw_data_prep_columns ( 
	raw_data_id          bigint  NOT NULL,
	column_name          varchar  NOT NULL,
	column_type          varchar  NOT NULL,
	CONSTRAINT idx_raw_data_prep_columns PRIMARY KEY ( raw_data_id, column_name, column_type ),
	CONSTRAINT fk_prep_columns_raw_data FOREIGN KEY ( raw_data_id ) REFERENCES qiita.raw_data( raw_data_id )    
 );

CREATE INDEX idx_prep_columns ON qiita.raw_data_prep_columns ( raw_data_id );

COMMENT ON TABLE qiita.raw_data_prep_columns IS 'Holds the columns available for a given raw data prep';

CREATE TABLE qiita.raw_preprocessed_data ( 
	raw_data_id          bigint  NOT NULL,
	preprocessed_data_id bigint  NOT NULL,
	CONSTRAINT idx_raw_preprocessed_data PRIMARY KEY ( raw_data_id, preprocessed_data_id ),
	CONSTRAINT fk_raw_preprocessed_data FOREIGN KEY ( raw_data_id ) REFERENCES qiita.raw_data( raw_data_id )    ,
	CONSTRAINT fk_raw_preprocessed_data_0 FOREIGN KEY ( preprocessed_data_id ) REFERENCES qiita.preprocessed_data( preprocessed_data_id )    
 );

CREATE INDEX idx_raw_preprocessed_data_0 ON qiita.raw_preprocessed_data ( raw_data_id );

CREATE INDEX idx_raw_preprocessed_data_1 ON qiita.raw_preprocessed_data ( preprocessed_data_id );

CREATE TABLE qiita.reference ( 
	reference_id         bigserial  NOT NULL,
	reference_name       varchar  NOT NULL,
	reference_version    varchar  ,
	sequence_filepath    varchar  NOT NULL,
	taxonomy_filepath    varchar  ,
	tree_filepath        varchar  ,
	CONSTRAINT pk_reference PRIMARY KEY ( reference_id )
 );

CREATE TABLE qiita.relationship_type ( 
	relationship_type_id bigserial  NOT NULL,
	relationship_type    varchar  NOT NULL,
	CONSTRAINT pk_relationship_type PRIMARY KEY ( relationship_type_id )
 );

CREATE TABLE qiita.required_sample_info_status ( 
	required_sample_info_status_id bigserial  NOT NULL,
	status               varchar  ,
	CONSTRAINT pk_sample_status PRIMARY KEY ( required_sample_info_status_id )
 );

CREATE TABLE qiita.severity ( 
	severity_id          serial  NOT NULL,
	severity             varchar  NOT NULL,
	CONSTRAINT pk_severity PRIMARY KEY ( severity_id )
 );

CREATE TABLE qiita.study_person ( 
	study_person_id      bigserial  NOT NULL,
	name                 varchar  NOT NULL,
	email                varchar  NOT NULL,
	address              varchar(100)  ,
	phone                varchar  ,
	CONSTRAINT pk_study_person PRIMARY KEY ( study_person_id )
 );

COMMENT ON TABLE qiita.study_person IS 'Contact information for the various people involved in a study';

CREATE TABLE qiita.study_status ( 
	study_status_id      bigserial  NOT NULL,
	status               varchar  NOT NULL,
	description          varchar  NOT NULL,
	CONSTRAINT pk_study_status PRIMARY KEY ( study_status_id )
 );

CREATE TABLE qiita.term ( 
	term_id              bigserial  NOT NULL,
	ontology_id          bigint  NOT NULL,
	term_name            varchar  NOT NULL,
	identifier           varchar  ,
	definition           varchar  ,
	namespace            varchar  ,
	is_obsolete          bool DEFAULT 'false' NOT NULL,
	is_root_term         bool  NOT NULL,
	is_leaf              bool  NOT NULL,
	CONSTRAINT pk_term PRIMARY KEY ( term_id ),
	CONSTRAINT idx_term UNIQUE ( ontology_id ) ,
	CONSTRAINT fk_term_ontology FOREIGN KEY ( ontology_id ) REFERENCES qiita.ontology( ontology_id )    
 );

CREATE TABLE qiita.term_path ( 
	term_path_id         bigserial  NOT NULL,
	subject_term_id      bigint  NOT NULL,
	predicate_term_id    bigint  NOT NULL,
	object_term_id       bigint  NOT NULL,
	ontology_id          bigint  NOT NULL,
	relationship_type_id integer  NOT NULL,
	distance             integer  ,
	CONSTRAINT pk_term_path PRIMARY KEY ( term_path_id ),
	CONSTRAINT fk_term_path_ontology FOREIGN KEY ( ontology_id ) REFERENCES qiita.ontology( ontology_id )    ,
	CONSTRAINT fk_term_path_relationship_type FOREIGN KEY ( relationship_type_id ) REFERENCES qiita.relationship_type( relationship_type_id )    ,
	CONSTRAINT fk_term_path_term_subject FOREIGN KEY ( subject_term_id ) REFERENCES qiita.term( term_id )    ,
	CONSTRAINT fk_term_path_term_predicate FOREIGN KEY ( predicate_term_id ) REFERENCES qiita.term( term_id )    ,
	CONSTRAINT fk_term_path_term_object FOREIGN KEY ( object_term_id ) REFERENCES qiita.term( term_id )    
 );

CREATE INDEX idx_term_path ON qiita.term_path ( ontology_id );

CREATE INDEX idx_term_path_relatonship ON qiita.term_path ( relationship_type_id );

CREATE INDEX idx_term_path_subject ON qiita.term_path ( subject_term_id );

CREATE INDEX idx_term_path_predicate ON qiita.term_path ( predicate_term_id );

CREATE INDEX idx_term_path_object ON qiita.term_path ( object_term_id );

CREATE TABLE qiita.term_relationship ( 
	term_relationship_id bigserial  NOT NULL,
	subject_term_id      bigint  NOT NULL,
	predicate_term_id    bigint  NOT NULL,
	object_term_id       bigint  NOT NULL,
	ontology_id          bigint  NOT NULL,
	CONSTRAINT pk_term_relationship PRIMARY KEY ( term_relationship_id ),
	CONSTRAINT fk_term_relationship_subj_term FOREIGN KEY ( subject_term_id ) REFERENCES qiita.term( term_id )    ,
	CONSTRAINT fk_term_relationship_pred_term FOREIGN KEY ( predicate_term_id ) REFERENCES qiita.term( term_id )    ,
	CONSTRAINT fk_term_relationship_obj_term FOREIGN KEY ( object_term_id ) REFERENCES qiita.term( term_id )    ,
	CONSTRAINT fk_term_relationship_ontology FOREIGN KEY ( ontology_id ) REFERENCES qiita.ontology( ontology_id )    
 );

CREATE INDEX idx_term_relationship_subject ON qiita.term_relationship ( subject_term_id );

CREATE INDEX idx_term_relationship_predicate ON qiita.term_relationship ( predicate_term_id );

CREATE INDEX idx_term_relationship_object ON qiita.term_relationship ( object_term_id );

CREATE INDEX idx_term_relationship_ontology ON qiita.term_relationship ( ontology_id );

CREATE TABLE qiita.term_synonym ( 
	synonym_id           bigserial  NOT NULL,
	term_id              bigint  NOT NULL,
	synonym_value        varchar  NOT NULL,
	synonym_type_id      bigint  NOT NULL,
	CONSTRAINT pk_term_synonym PRIMARY KEY ( synonym_id ),
	CONSTRAINT fk_term_synonym_term FOREIGN KEY ( term_id ) REFERENCES qiita.term( term_id )    ,
	CONSTRAINT fk_term_synonym_type_term FOREIGN KEY ( synonym_id ) REFERENCES qiita.term( term_id )    
 );

CREATE INDEX idx_term_synonym ON qiita.term_synonym ( term_id );

CREATE TABLE qiita.timeseries_type ( 
	timeseries_type_id   bigserial  NOT NULL,
	timeseries_type      varchar  NOT NULL,
	CONSTRAINT pk_timeseries_type PRIMARY KEY ( timeseries_type_id )
 );

CREATE TABLE qiita.user_level ( 
	user_level_id        serial  NOT NULL,
	name                 varchar  NOT NULL,
	description          text  NOT NULL,
	CONSTRAINT pk_user_level PRIMARY KEY ( user_level_id )
 );

COMMENT ON TABLE qiita.user_level IS 'Holds available user levels';

COMMENT ON COLUMN qiita.user_level.name IS 'One of the user levels (admin, user, guest, etc)';

CREATE TABLE qiita.annotation ( 
	annotation_id        bigserial  NOT NULL,
	term_id              bigint  NOT NULL,
	annotation_name      varchar  NOT NULL,
	annotation_num_value bigint  ,
	annotation_str_value varchar  ,
	CONSTRAINT pk_annotation PRIMARY KEY ( annotation_id ),
	CONSTRAINT fk_annotation_term FOREIGN KEY ( term_id ) REFERENCES qiita.term( term_id )    
 );

CREATE INDEX idx_annotation ON qiita.annotation ( term_id );

CREATE TABLE qiita.column_controlled_vocabularies ( 
	controlled_vocab_id  bigserial  NOT NULL,
	column_name          varchar  NOT NULL,
	CONSTRAINT idx_column_controlled_vocabularies PRIMARY KEY ( controlled_vocab_id, column_name ),
	CONSTRAINT fk_column_controlled_vocabularies FOREIGN KEY ( column_name ) REFERENCES qiita.mixs_field_description( column_name )    ,
	CONSTRAINT fk_column_controlled_vocab2 FOREIGN KEY ( controlled_vocab_id ) REFERENCES qiita.controlled_vocabularies( controlled_vocab_id )    
 );

CREATE INDEX idx_column_controlled_vocabularies_0 ON qiita.column_controlled_vocabularies ( column_name );

CREATE INDEX idx_column_controlled_vocabularies_1 ON qiita.column_controlled_vocabularies ( controlled_vocab_id );

COMMENT ON TABLE qiita.column_controlled_vocabularies IS 'Table relates a column with a controlled vocabulary.';

CREATE TABLE qiita.column_ontology ( 
	column_name          varchar  NOT NULL,
	ontology_short_name  varchar  NOT NULL,
	bioportal_id         integer  NOT NULL,
	ontology_branch_id   integer  NOT NULL,
	CONSTRAINT idx_column_ontology PRIMARY KEY ( column_name, ontology_short_name ),
	CONSTRAINT fk_column_ontology FOREIGN KEY ( column_name ) REFERENCES qiita.mixs_field_description( column_name )    
 );

CREATE INDEX idx_column_ontology_0 ON qiita.column_ontology ( column_name );

COMMENT ON TABLE qiita.column_ontology IS 'This table relates a column with an ontology.';

CREATE TABLE qiita.command_data_type ( 
	command_id           bigint  NOT NULL,
	data_type_id         bigint  NOT NULL,
	CONSTRAINT idx_command_data_type PRIMARY KEY ( command_id, data_type_id ),
	CONSTRAINT fk_command_data_type FOREIGN KEY ( command_id ) REFERENCES qiita.command( command_id )    ,
	CONSTRAINT fk_command_data_type_0 FOREIGN KEY ( data_type_id ) REFERENCES qiita.data_type( data_type_id )    
 );

CREATE INDEX idx_command_data_type_0 ON qiita.command_data_type ( command_id );

CREATE INDEX idx_command_data_type_1 ON qiita.command_data_type ( data_type_id );

CREATE TABLE qiita.controlled_vocab_values ( 
	vocab_value_id       bigserial  NOT NULL,
	controlled_vocab_id  bigint  NOT NULL,
	term                 varchar  NOT NULL,
	order_by             varchar  NOT NULL,
	default_item         varchar  ,
	CONSTRAINT pk_controlled_vocab_values PRIMARY KEY ( vocab_value_id ),
	CONSTRAINT fk_controlled_vocab_values FOREIGN KEY ( controlled_vocab_id ) REFERENCES qiita.controlled_vocabularies( controlled_vocab_id ) ON DELETE CASCADE ON UPDATE CASCADE
 );

CREATE INDEX idx_controlled_vocab_values ON qiita.controlled_vocab_values ( controlled_vocab_id );

CREATE TABLE qiita.dbxref ( 
	dbxref_id            bigserial  NOT NULL,
	term_id              bigint  NOT NULL,
	dbname               varchar  NOT NULL,
	accession            varchar  NOT NULL,
	description          varchar  NOT NULL,
	xref_type            varchar  NOT NULL,
	CONSTRAINT pk_dbxref PRIMARY KEY ( dbxref_id ),
	CONSTRAINT fk_dbxref_term FOREIGN KEY ( term_id ) REFERENCES qiita.term( term_id )    
 );

CREATE INDEX idx_dbxref ON qiita.dbxref ( term_id );

CREATE TABLE qiita.filepath ( 
	filepath_id          bigserial  NOT NULL,
	filepath             varchar  NOT NULL,
	filepath_type_id     bigint  NOT NULL,
	checksum             varchar  NOT NULL,
	checksum_algorithm_id bigint  NOT NULL,
	CONSTRAINT pk_filepath PRIMARY KEY ( filepath_id ),
	CONSTRAINT fk_filepath FOREIGN KEY ( filepath_type_id ) REFERENCES qiita.filepath_type( filepath_type_id )    ,
	CONSTRAINT fk_filepath_0 FOREIGN KEY ( checksum_algorithm_id ) REFERENCES qiita.checksum_algorithm( checksum_algorithm_id )    
 );

CREATE INDEX idx_filepath ON qiita.filepath ( filepath_type_id );

CREATE TABLE qiita.investigation ( 
	investigation_id     bigserial  NOT NULL,
	name                 varchar  NOT NULL,
	description          varchar  NOT NULL,
	contact_person_id    bigint  ,
	CONSTRAINT pk_investigation PRIMARY KEY ( investigation_id ),
	CONSTRAINT fk_investigation_study_person FOREIGN KEY ( contact_person_id ) REFERENCES qiita.study_person( study_person_id )    
 );

CREATE INDEX idx_investigation ON qiita.investigation ( contact_person_id );

COMMENT ON TABLE qiita.investigation IS 'Overarching investigation information.
An investigation comprises one or more individual studies.';

COMMENT ON COLUMN qiita.investigation.description IS 'Describes the overarching goal of the investigation';

CREATE TABLE qiita.logging ( 
	logging_id           bigserial  NOT NULL,
	time                 timestamp  NOT NULL,
	severity_id          integer  NOT NULL,
	msg                  varchar  NOT NULL,
	information          varchar  ,
	CONSTRAINT pk_logging PRIMARY KEY ( logging_id ),
	CONSTRAINT fk_logging_severity FOREIGN KEY ( severity_id ) REFERENCES qiita.severity( severity_id )    
 );

CREATE INDEX idx_logging_0 ON qiita.logging ( severity_id );

COMMENT ON COLUMN qiita.logging.time IS 'Time the error was thrown';

COMMENT ON COLUMN qiita.logging.msg IS 'Error message thrown';

COMMENT ON COLUMN qiita.logging.information IS 'Other applicable information (depending on error)';

CREATE TABLE qiita.preprocessed_filepath ( 
	preprocessed_data_id bigint  NOT NULL,
	filepath_id          bigint  NOT NULL,
	CONSTRAINT idx_preprocessed_filepath PRIMARY KEY ( preprocessed_data_id, filepath_id ),
	CONSTRAINT fk_preprocessed_filepath FOREIGN KEY ( preprocessed_data_id ) REFERENCES qiita.preprocessed_data( preprocessed_data_id )    ,
	CONSTRAINT fk_preprocessed_filepath_0 FOREIGN KEY ( filepath_id ) REFERENCES qiita.filepath( filepath_id )    
 );

CREATE INDEX idx_preprocessed_filepath_0 ON qiita.preprocessed_filepath ( preprocessed_data_id );

CREATE INDEX idx_preprocessed_filepath_1 ON qiita.preprocessed_filepath ( filepath_id );

CREATE TABLE qiita.preprocessed_processed_data ( 
	preprocessed_data_id bigint  NOT NULL,
	processed_data_id    bigint  NOT NULL,
	CONSTRAINT idx_preprocessed_processed_data PRIMARY KEY ( preprocessed_data_id, processed_data_id ),
	CONSTRAINT fk_preprocessed_processed_data FOREIGN KEY ( preprocessed_data_id ) REFERENCES qiita.preprocessed_data( preprocessed_data_id )    ,
	CONSTRAINT fk_preprocessed_processed_data_0 FOREIGN KEY ( processed_data_id ) REFERENCES qiita.processed_data( processed_data_id )    
 );

CREATE INDEX idx_preprocessed_processed_data_0 ON qiita.preprocessed_processed_data ( preprocessed_data_id );

CREATE INDEX idx_preprocessed_processed_data_1 ON qiita.preprocessed_processed_data ( processed_data_id );

CREATE TABLE qiita.processed_filepath ( 
	processed_data_id    bigint  NOT NULL,
	filepath_id          bigint  NOT NULL,
	CONSTRAINT idx_processed_filepath PRIMARY KEY ( processed_data_id, filepath_id ),
	CONSTRAINT fk_processed_data_filepath FOREIGN KEY ( processed_data_id ) REFERENCES qiita.processed_data( processed_data_id )    ,
	CONSTRAINT fk_processed_data_filepath_0 FOREIGN KEY ( filepath_id ) REFERENCES qiita.filepath( filepath_id )    
 );

CREATE TABLE qiita.processed_params_uclust ( 
	processed_params_id  bigserial  NOT NULL,
	reference_id         bigint  NOT NULL,
	similarity           float8 DEFAULT 0.97 NOT NULL,
	enable_rev_strand_match bool DEFAULT TRUE NOT NULL,
	suppress_new_clusters bool DEFAULT TRUE NOT NULL,
	CONSTRAINT pk_processed_params_uclust PRIMARY KEY ( processed_params_id ),
	CONSTRAINT fk_processed_params_uclust FOREIGN KEY ( reference_id ) REFERENCES qiita.reference( reference_id )    
 );

CREATE INDEX idx_processed_params_uclust ON qiita.processed_params_uclust ( reference_id );

COMMENT ON TABLE qiita.processed_params_uclust IS 'Parameters used for processing data using method uclust';

COMMENT ON COLUMN qiita.processed_params_uclust.reference_id IS 'What version of reference or type of reference used';

CREATE TABLE qiita.qiita_user ( 
	email                varchar  NOT NULL,
	user_level_id        integer DEFAULT 5 NOT NULL,
	password             varchar  NOT NULL,
	name                 varchar  ,
	affiliation          varchar  ,
	address              varchar  ,
	phone                varchar  ,
	user_verify_code     varchar  ,
	pass_reset_code      varchar  ,
	pass_reset_timestamp timestamp  ,
	CONSTRAINT pk_user PRIMARY KEY ( email ),
	CONSTRAINT fk_user_user_level FOREIGN KEY ( user_level_id ) REFERENCES qiita.user_level( user_level_id )   ON UPDATE RESTRICT
 );

CREATE INDEX idx_user ON qiita.qiita_user ( user_level_id );

COMMENT ON TABLE qiita.qiita_user IS 'Holds all user information';

COMMENT ON COLUMN qiita.qiita_user.user_level_id IS 'user level';

COMMENT ON COLUMN qiita.qiita_user.user_verify_code IS 'Code for initial user email verification';

COMMENT ON COLUMN qiita.qiita_user.pass_reset_code IS 'Randomly generated code for password reset';

COMMENT ON COLUMN qiita.qiita_user.pass_reset_timestamp IS 'Time the reset code was generated';

CREATE TABLE qiita.raw_filepath ( 
	raw_data_id          bigint  NOT NULL,
	filepath_id          bigint  NOT NULL,
	CONSTRAINT idx_raw_filepath PRIMARY KEY ( raw_data_id, filepath_id ),
	CONSTRAINT fk_raw_filepath FOREIGN KEY ( filepath_id ) REFERENCES qiita.filepath( filepath_id )    ,
	CONSTRAINT fk_raw_filepath_0 FOREIGN KEY ( raw_data_id ) REFERENCES qiita.raw_data( raw_data_id )    
 );

CREATE INDEX idx_raw_filepath_0 ON qiita.raw_filepath ( filepath_id );

CREATE INDEX idx_raw_filepath_1 ON qiita.raw_filepath ( raw_data_id );

CREATE TABLE qiita.study ( 
	study_id             bigserial  NOT NULL,
	email                varchar  NOT NULL,
	study_status_id      bigint  NOT NULL,
	emp_person_id        bigint  ,
	first_contact        varchar  NOT NULL,
	funding              varchar  ,
	timeseries_type_id   bigint  NOT NULL,
	lab_person_id        bigint  ,
	metadata_complete    bool  NOT NULL,
	mixs_compliant       bool  NOT NULL,
	most_recent_contact  varchar  ,
	number_samples_collected integer  NOT NULL,
	number_samples_promised integer  NOT NULL,
	portal_type_id       bigint  NOT NULL,
	principal_investigator_id bigint  NOT NULL,
	reprocess            bool  NOT NULL,
	spatial_series       bool  ,
	study_title          varchar  NOT NULL,
	study_alias          varchar  NOT NULL,
	study_description    text  NOT NULL,
	study_abstract       text  NOT NULL,
	vamps_id             varchar  ,
	CONSTRAINT pk_study PRIMARY KEY ( study_id ),
	CONSTRAINT fk_study_user FOREIGN KEY ( email ) REFERENCES qiita.qiita_user( email )    ,
	CONSTRAINT fk_study_study_status FOREIGN KEY ( study_status_id ) REFERENCES qiita.study_status( study_status_id )    ,
	CONSTRAINT fk_study_study_emp_person FOREIGN KEY ( emp_person_id ) REFERENCES qiita.study_person( study_person_id )    ,
	CONSTRAINT fk_study_study_lab_person FOREIGN KEY ( lab_person_id ) REFERENCES qiita.study_person( study_person_id )    ,
	CONSTRAINT fk_study_study_pi_person FOREIGN KEY ( principal_investigator_id ) REFERENCES qiita.study_person( study_person_id )    ,
	CONSTRAINT fk_study_timeseries_type FOREIGN KEY ( timeseries_type_id ) REFERENCES qiita.timeseries_type( timeseries_type_id )    ,
	CONSTRAINT fk_study FOREIGN KEY ( portal_type_id ) REFERENCES qiita.portal_type( portal_type_id )    
 );

CREATE INDEX idx_study ON qiita.study ( email );

CREATE INDEX idx_study_0 ON qiita.study ( study_status_id );

CREATE INDEX idx_study_1 ON qiita.study ( emp_person_id );

CREATE INDEX idx_study_2 ON qiita.study ( lab_person_id );

CREATE INDEX idx_study_3 ON qiita.study ( principal_investigator_id );

CREATE INDEX idx_study_4 ON qiita.study ( timeseries_type_id );

CREATE INDEX idx_study_5 ON qiita.study ( portal_type_id );

COMMENT ON COLUMN qiita.study.study_id IS 'Unique name for study';

COMMENT ON COLUMN qiita.study.email IS 'Email of study owner';

COMMENT ON COLUMN qiita.study.timeseries_type_id IS 'What type of timeseries this study is (or is not)
Controlled Vocabulary';

CREATE TABLE qiita.study_experimental_factor ( 
	study_id             bigint  NOT NULL,
	efo_id               bigint  NOT NULL,
	CONSTRAINT idx_study_experimental_factor PRIMARY KEY ( study_id, efo_id ),
	CONSTRAINT fk_study_experimental_factor FOREIGN KEY ( study_id ) REFERENCES qiita.study( study_id )    
 );

CREATE INDEX idx_study_experimental_factor_0 ON qiita.study_experimental_factor ( study_id );

COMMENT ON TABLE qiita.study_experimental_factor IS 'EFO ontological link of experimental factors to studies';

CREATE TABLE qiita.study_pmid ( 
	study_id             bigint  NOT NULL,
	pmid                 varchar  NOT NULL,
	CONSTRAINT idx_study_pmid PRIMARY KEY ( study_id, pmid ),
	CONSTRAINT fk_study_pmid_study FOREIGN KEY ( study_id ) REFERENCES qiita.study( study_id )    
 );

CREATE INDEX idx_study_pmid_0 ON qiita.study_pmid ( study_id );

COMMENT ON TABLE qiita.study_pmid IS 'Links a study to all PMIDs for papers created from study';

CREATE TABLE qiita.study_preprocessed_data ( 
	study_id             bigint  NOT NULL,
	preprocessed_data_id bigint  NOT NULL,
	CONSTRAINT idx_study_preprocessed_data PRIMARY KEY ( study_id, preprocessed_data_id ),
	CONSTRAINT fk_study_preprocessed_data FOREIGN KEY ( study_id ) REFERENCES qiita.study( study_id )    ,
	CONSTRAINT fk_study_preprocessed_data_0 FOREIGN KEY ( preprocessed_data_id ) REFERENCES qiita.preprocessed_data( preprocessed_data_id )    
 );

CREATE INDEX idx_study_preprocessed_data_0 ON qiita.study_preprocessed_data ( study_id );

CREATE INDEX idx_study_preprocessed_data_1 ON qiita.study_preprocessed_data ( preprocessed_data_id );

CREATE TABLE qiita.study_processed_data ( 
	study_id             bigint  NOT NULL,
	processed_data_id    bigint  NOT NULL,
	CONSTRAINT idx_study_processed_data PRIMARY KEY ( study_id, processed_data_id ),
	CONSTRAINT pk_study_processed_data UNIQUE ( processed_data_id ) ,
	CONSTRAINT fk_study_processed_data FOREIGN KEY ( study_id ) REFERENCES qiita.study( study_id )    ,
	CONSTRAINT fk_study_processed_data_0 FOREIGN KEY ( processed_data_id ) REFERENCES qiita.processed_data( processed_data_id )    
 );

CREATE INDEX idx_study_processed_data_0 ON qiita.study_processed_data ( study_id );

CREATE TABLE qiita.study_raw_data ( 
	study_id             bigint  NOT NULL,
	raw_data_id          bigint  NOT NULL,
	CONSTRAINT idx_study_raw_data_0 PRIMARY KEY ( study_id, raw_data_id ),
	CONSTRAINT fk_study_raw_data_study FOREIGN KEY ( study_id ) REFERENCES qiita.study( study_id )    ,
	CONSTRAINT fk_study_raw_data_raw_data FOREIGN KEY ( raw_data_id ) REFERENCES qiita.raw_data( raw_data_id )    
 );

CREATE INDEX idx_study_raw_data ON qiita.study_raw_data ( study_id );

COMMENT ON TABLE qiita.study_raw_data IS 'links study to its raw data';

CREATE TABLE qiita.study_sample_columns ( 
	study_id             bigint  NOT NULL,
	column_name          varchar(100)  NOT NULL,
	column_type          varchar  NOT NULL,
	CONSTRAINT idx_study_mapping_columns PRIMARY KEY ( study_id, column_name, column_type ),
	CONSTRAINT fk_study_mapping_columns_study FOREIGN KEY ( study_id ) REFERENCES qiita.study( study_id )    
 );

CREATE INDEX idx_study_mapping_columns_study_id ON qiita.study_sample_columns ( study_id );

COMMENT ON TABLE qiita.study_sample_columns IS 'Holds information on which metadata columns are available for the study sample template';

CREATE TABLE qiita.study_users ( 
	study_id             bigint  NOT NULL,
	email                varchar  NOT NULL,
	CONSTRAINT idx_study_users PRIMARY KEY ( study_id, email ),
	CONSTRAINT fk_study_users_study FOREIGN KEY ( study_id ) REFERENCES qiita.study( study_id )    ,
	CONSTRAINT fk_study_users_user FOREIGN KEY ( email ) REFERENCES qiita.qiita_user( email )    
 );

CREATE INDEX idx_study_users_0 ON qiita.study_users ( study_id );

CREATE INDEX idx_study_users_1 ON qiita.study_users ( email );

COMMENT ON TABLE qiita.study_users IS 'Links shared studies to users they are shared with';

CREATE TABLE qiita.analysis ( 
	analysis_id          bigserial  NOT NULL,
	email                varchar  NOT NULL,
	name                 varchar  NOT NULL,
	description          varchar  NOT NULL,
	analysis_status_id   bigint  NOT NULL,
	pmid                 varchar  ,
	CONSTRAINT pk_analysis PRIMARY KEY ( analysis_id ),
	CONSTRAINT fk_analysis_user FOREIGN KEY ( email ) REFERENCES qiita.qiita_user( email )    ,
	CONSTRAINT fk_analysis_analysis_status FOREIGN KEY ( analysis_status_id ) REFERENCES qiita.analysis_status( analysis_status_id )    
 );

CREATE INDEX idx_analysis_email ON qiita.analysis ( email );

CREATE INDEX idx_analysis_status_id ON qiita.analysis ( analysis_status_id );

COMMENT ON TABLE qiita.analysis IS 'hHolds analysis information';

COMMENT ON COLUMN qiita.analysis.analysis_id IS 'Unique identifier for analysis';

COMMENT ON COLUMN qiita.analysis.email IS 'Email for user who owns the analysis';

COMMENT ON COLUMN qiita.analysis.name IS 'Name of the analysis';

COMMENT ON COLUMN qiita.analysis.pmid IS 'PMID of paper from the analysis';

CREATE TABLE qiita.analysis_chain ( 
	parent_id            bigint  NOT NULL,
	child_id             bigint  NOT NULL,
	CONSTRAINT idx_analysis_chain_1 PRIMARY KEY ( parent_id, child_id ),
	CONSTRAINT fk_analysis_chain FOREIGN KEY ( parent_id ) REFERENCES qiita.analysis( analysis_id )    ,
	CONSTRAINT fk_analysis_chain_0 FOREIGN KEY ( child_id ) REFERENCES qiita.analysis( analysis_id )    
 );

CREATE INDEX idx_analysis_chain ON qiita.analysis_chain ( parent_id );

CREATE INDEX idx_analysis_chain_0 ON qiita.analysis_chain ( child_id );

COMMENT ON TABLE qiita.analysis_chain IS 'Keeps track of the chain of analysis edits. Tracks what previous analysis a given analysis came from.
If a given analysis is not in child_id, it is the root of the chain. ';

CREATE TABLE qiita.analysis_filepath ( 
	analysis_id          bigint  NOT NULL,
	filepath_id          bigint  NOT NULL,
	data_type_id         bigint  NOT NULL,
	CONSTRAINT idx_analysis_filepath_1 PRIMARY KEY ( analysis_id, filepath_id ),
	CONSTRAINT fk_analysis_filepath FOREIGN KEY ( analysis_id ) REFERENCES qiita.analysis( analysis_id )    ,
	CONSTRAINT fk_analysis_filepath_0 FOREIGN KEY ( filepath_id ) REFERENCES qiita.filepath( filepath_id )    ,
	CONSTRAINT fk_analysis_filepath_2 FOREIGN KEY ( data_type_id ) REFERENCES qiita.data_type( data_type_id )    
 );

CREATE INDEX idx_analysis_filepath ON qiita.analysis_filepath ( analysis_id );

CREATE INDEX idx_analysis_filepath_0 ON qiita.analysis_filepath ( filepath_id );

CREATE INDEX idx_analysis_filepath_3 ON qiita.analysis_filepath ( data_type_id );

COMMENT ON TABLE qiita.analysis_filepath IS 'Stores link between analysis and the data file used for the analysis.';

CREATE TABLE qiita.analysis_users ( 
	analysis_id          bigint  NOT NULL,
	email                varchar  NOT NULL,
	CONSTRAINT idx_analysis_users PRIMARY KEY ( analysis_id, email ),
	CONSTRAINT fk_analysis_users_analysis FOREIGN KEY ( analysis_id ) REFERENCES qiita.analysis( analysis_id ) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT fk_analysis_users_user FOREIGN KEY ( email ) REFERENCES qiita.qiita_user( email ) ON DELETE CASCADE ON UPDATE CASCADE
 );

CREATE INDEX idx_analysis_users_analysis ON qiita.analysis_users ( analysis_id );

CREATE INDEX idx_analysis_users_email ON qiita.analysis_users ( email );

COMMENT ON TABLE qiita.analysis_users IS 'Links analyses to the users they are shared with';

CREATE TABLE qiita.analysis_workflow ( 
	analysis_id          bigint  NOT NULL,
	step                 integer  NOT NULL,
	CONSTRAINT pk_analysis_workflow PRIMARY KEY ( analysis_id ),
	CONSTRAINT fk_analysis_workflow FOREIGN KEY ( analysis_id ) REFERENCES qiita.analysis( analysis_id )    
 );

COMMENT ON TABLE qiita.analysis_workflow IS 'Stores what step in_production analyses are on.';

CREATE TABLE qiita.investigation_study ( 
	investigation_id     bigint  NOT NULL,
	study_id             bigint  NOT NULL,
	CONSTRAINT idx_investigation_study PRIMARY KEY ( investigation_id, study_id ),
	CONSTRAINT fk_investigation_study FOREIGN KEY ( investigation_id ) REFERENCES qiita.investigation( investigation_id )    ,
	CONSTRAINT fk_investigation_study_study FOREIGN KEY ( study_id ) REFERENCES qiita.study( study_id )    
 );

CREATE INDEX idx_investigation_study_investigation ON qiita.investigation_study ( investigation_id );

CREATE INDEX idx_investigation_study_study ON qiita.investigation_study ( study_id );

CREATE TABLE qiita.job ( 
	job_id               bigserial  NOT NULL,
	data_type_id         bigint  NOT NULL,
	job_status_id        bigint  NOT NULL,
	command_id           bigint  NOT NULL,
	options              varchar  ,
	log_id               bigint  ,
	CONSTRAINT pk_job PRIMARY KEY ( job_id ),
	CONSTRAINT fk_job_function FOREIGN KEY ( command_id ) REFERENCES qiita.command( command_id )    ,
	CONSTRAINT fk_job_job_status_id FOREIGN KEY ( job_status_id ) REFERENCES qiita.job_status( job_status_id )    ,
	CONSTRAINT fk_job_data_type FOREIGN KEY ( data_type_id ) REFERENCES qiita.data_type( data_type_id )    ,
	CONSTRAINT fk_job FOREIGN KEY ( log_id ) REFERENCES qiita.logging( logging_id )    
 );

CREATE INDEX idx_job_command ON qiita.job ( command_id );

CREATE INDEX idx_job_status ON qiita.job ( job_status_id );

CREATE INDEX idx_job_type ON qiita.job ( data_type_id );

CREATE INDEX idx_job ON qiita.job ( log_id );

COMMENT ON COLUMN qiita.job.job_id IS 'Unique identifier for job';

COMMENT ON COLUMN qiita.job.data_type_id IS 'What datatype (16s, metabolome, etc) job is run on.';

COMMENT ON COLUMN qiita.job.command_id IS 'The Qiime or other function being run (alpha diversity, etc)';

COMMENT ON COLUMN qiita.job.options IS 'Holds all options set for the job as a json string';

COMMENT ON COLUMN qiita.job.log_id IS 'Reference to error if status is error';

CREATE TABLE qiita.job_results_filepath ( 
	job_id               bigint  NOT NULL,
	filepath_id          bigint  NOT NULL,
	CONSTRAINT idx_job_results_filepath PRIMARY KEY ( job_id, filepath_id ),
	CONSTRAINT fk_job_results_filepath FOREIGN KEY ( job_id ) REFERENCES qiita.job( job_id )    ,
	CONSTRAINT fk_job_results_filepath_0 FOREIGN KEY ( filepath_id ) REFERENCES qiita.filepath( filepath_id )    
 );

CREATE INDEX idx_job_results_filepath_0 ON qiita.job_results_filepath ( job_id );

CREATE INDEX idx_job_results_filepath_1 ON qiita.job_results_filepath ( filepath_id );

COMMENT ON TABLE qiita.job_results_filepath IS 'Holds connection between jobs and the result filepaths';

CREATE TABLE qiita.required_sample_info ( 
	study_id             bigint  NOT NULL,
	sample_id            varchar  NOT NULL,
	physical_location    varchar  NOT NULL,
	has_physical_specimen bool  NOT NULL,
	has_extracted_data   bool  NOT NULL,
	sample_type          varchar  NOT NULL,
	required_sample_info_status_id bigint  NOT NULL,
	collection_timestamp timestamp  NOT NULL,
	host_subject_id      varchar  NOT NULL,
	description          varchar  NOT NULL,
	CONSTRAINT idx_common_sample_information PRIMARY KEY ( study_id, sample_id ),
	CONSTRAINT pk_required_sample_info UNIQUE ( sample_id ) ,
	CONSTRAINT fk_required_sample_info_study FOREIGN KEY ( study_id ) REFERENCES qiita.study( study_id )    ,
	CONSTRAINT fk_required_sample_info FOREIGN KEY ( required_sample_info_status_id ) REFERENCES qiita.required_sample_info_status( required_sample_info_status_id )    
 );

CREATE INDEX idx_required_sample_info ON qiita.required_sample_info ( study_id );

CREATE INDEX idx_required_sample_info_0 ON qiita.required_sample_info ( required_sample_info_status_id );

COMMENT ON TABLE qiita.required_sample_info IS 'Required info for each sample. One row is one sample.';

COMMENT ON COLUMN qiita.required_sample_info.physical_location IS 'Where the sample itself is stored';

COMMENT ON COLUMN qiita.required_sample_info.has_physical_specimen IS 'Whether we have the full speciment or just DNA';

COMMENT ON COLUMN qiita.required_sample_info.sample_type IS 'Controlled vocabulary of sample types';

COMMENT ON COLUMN qiita.required_sample_info.required_sample_info_status_id IS 'What step of the pipeline the samples are in';

CREATE TABLE qiita.analysis_job ( 
	analysis_id          bigint  NOT NULL,
	job_id               bigint  NOT NULL,
	CONSTRAINT idx_analysis_jobs PRIMARY KEY ( analysis_id, job_id ),
	CONSTRAINT fk_analysis_job_analysis FOREIGN KEY ( analysis_id ) REFERENCES qiita.analysis( analysis_id ) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT fk_analysis_job_job FOREIGN KEY ( job_id ) REFERENCES qiita.job( job_id )    
 );

CREATE INDEX idx_analysis_job ON qiita.analysis_job ( analysis_id );

CREATE INDEX idx_analysis_job_0 ON qiita.analysis_job ( job_id );

COMMENT ON TABLE qiita.analysis_job IS 'Holds information for a one-to-many relation of analysis to the jobs in it';

COMMENT ON COLUMN qiita.analysis_job.analysis_id IS 'Id of the analysis';

COMMENT ON COLUMN qiita.analysis_job.job_id IS 'Id for a job that is part of the analysis';

CREATE TABLE qiita.analysis_sample ( 
	analysis_id          bigint  NOT NULL,
	processed_data_id    bigint  NOT NULL,
	sample_id            varchar  NOT NULL,
	study_id             bigint  NOT NULL,
	CONSTRAINT fk_analysis_sample_analysis FOREIGN KEY ( analysis_id ) REFERENCES qiita.analysis( analysis_id )    ,
	CONSTRAINT fk_analysis_sample FOREIGN KEY ( processed_data_id ) REFERENCES qiita.processed_data( processed_data_id )    ,
	CONSTRAINT fk_analysis_sample_sample FOREIGN KEY ( sample_id ) REFERENCES qiita.required_sample_info( sample_id )    ,
	CONSTRAINT fk_analysis_sample_study FOREIGN KEY ( study_id ) REFERENCES qiita.study( study_id )    
 );

CREATE INDEX idx_analysis_sample ON qiita.analysis_sample ( analysis_id );

CREATE INDEX idx_analysis_sample_0 ON qiita.analysis_sample ( processed_data_id );

CREATE INDEX idx_analysis_sample_1 ON qiita.analysis_sample ( sample_id );

CREATE INDEX idx_analysis_sample_2 ON qiita.analysis_sample ( study_id );

CREATE TABLE qiita.common_prep_info ( 
	raw_data_id          bigserial  NOT NULL,
	sample_id            varchar  NOT NULL,
	center_name          varchar  ,
	center_project_name  varchar  ,
	ebi_submission_accession varchar  ,
	ebi_study_accession  varchar  ,
	emp_status_id        bigint  NOT NULL,
	data_type_id         bigint  NOT NULL,
	CONSTRAINT idx_required_prep_info_1 PRIMARY KEY ( raw_data_id, sample_id ),
	CONSTRAINT fk_required_prep_info_raw_data FOREIGN KEY ( raw_data_id ) REFERENCES qiita.raw_data( raw_data_id )    ,
	CONSTRAINT fk_required_prep_info_emp_status FOREIGN KEY ( emp_status_id ) REFERENCES qiita.emp_status( emp_status_id )    ,
	CONSTRAINT fk_required_prep_info FOREIGN KEY ( sample_id ) REFERENCES qiita.required_sample_info( sample_id )    ,
	CONSTRAINT fk_required_prep_info_0 FOREIGN KEY ( data_type_id ) REFERENCES qiita.data_type( data_type_id )    
 );

CREATE INDEX idx_required_prep_info ON qiita.common_prep_info ( raw_data_id );

CREATE INDEX idx_required_prep_info_0 ON qiita.common_prep_info ( emp_status_id );

CREATE INDEX idx_required_prep_info_2 ON qiita.common_prep_info ( sample_id );

CREATE INDEX idx_required_prep_info_3 ON qiita.common_prep_info ( data_type_id );

]]></string>
		</script>
	</layout>
</project>